<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xinyuan(Christine), Yuqing(Demi)">
<meta name="dcterms.date" content="2025-12-02">

<title>Space-Time Prediction of Bike Share Demand: Philadelphia Indego – Christine Cui - MUSA 5080 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Christine Cui - MUSA 5080 Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-notes">    
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-01-notes.html">
 <span class="dropdown-text">Week 1: Course Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-02-notes.html">
 <span class="dropdown-text">Week 2: Algorithmic Decision Making &amp; Census Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-03-notes.html">
 <span class="dropdown-text">Week 3: Data Visualization &amp; Exploratory Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-03/week3_lab_exercise.html">
 <span class="dropdown-text">In-Class Lab 3: Data Visualization and EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-04-notes.html">
 <span class="dropdown-text">Week 4: Spatial Data &amp; GIS Operations in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-04/scripts/week4_inclass_practice.html">
 <span class="dropdown-text">In-Class Lab 4: Spatial Operations with Pennsylvania Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-05-notes.html">
 <span class="dropdown-text">Week 5: Introduction to Linear Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-06-notes.html">
 <span class="dropdown-text">Week 6: Spatial Machine Learning &amp; Advanced Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-07-notes.html">
 <span class="dropdown-text">Week 7: Model Diagnostics &amp; Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-09-notes.html">
 <span class="dropdown-text">Week 9: Critical Perspectives on Predictive Policing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-09/lab/predictive_policing_exercise.html">
 <span class="dropdown-text">In-Class Lab 9: Predictive Policing - Technical Implementation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-10-notes.html">
 <span class="dropdown-text">Week 10: Logistic Regression for Binary Outcomes: The case of recidivism</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../weekly-notes/week-10/script/In_Class_Exercise_Instruction.html">
 <span class="dropdown-text">In-Class Lab 10: Georgia DOC Policy Advisory Challenge</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../../labs/lab_0/lab0_template.html">
 <span class="dropdown-text">Lab 0: Dplyr Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab_1/assignment1_template.html">
 <span class="dropdown-text">Lab 1: Census Data Exploration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab_2/assignment2_template.html">
 <span class="dropdown-text">Lab 2: Spatial Analysis and Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab_4/assignment4_template.html">
 <span class="dropdown-text">Lab 4: Spatial Predictive Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab_5/Assignment5_SpaceTimePrediction.html">
 <span class="dropdown-text">Lab 5: Space-Time Prediction of Bike Share Demand</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-midterm-project" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Midterm Project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-midterm-project">    
        <li>
    <a class="dropdown-item" href="../../midterm/Slides/CuiXinyuan_Presentation.html">
 <span class="dropdown-text">Midterm Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../midterm/Appendix/CuiXinyuan_Appendix.html">
 <span class="dropdown-text">Midterm Appendix</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-compare-2024-q3-with-2025-q1" id="toc-part-1-compare-2024-q3-with-2025-q1" class="nav-link active" data-scroll-target="#part-1-compare-2024-q3-with-2025-q1">PART 1: Compare 2024 Q3 with 2025 Q1</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">1. Setup</a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">1.1 Load libraries</a></li>
  <li><a href="#define-themes" id="toc-define-themes" class="nav-link" data-scroll-target="#define-themes">1.2 Define Themes</a></li>
  <li><a href="#set-census-api-key" id="toc-set-census-api-key" class="nav-link" data-scroll-target="#set-census-api-key">1.3 Set Census API Key</a></li>
  </ul></li>
  <li><a href="#data-import-preparation" id="toc-data-import-preparation" class="nav-link" data-scroll-target="#data-import-preparation">2. Data Import &amp; Preparation</a>
  <ul class="collapse">
  <li><a href="#load-indego-trip-data" id="toc-load-indego-trip-data" class="nav-link" data-scroll-target="#load-indego-trip-data">2.1 Load Indego Trip Data</a></li>
  <li><a href="#examine-the-data-structure" id="toc-examine-the-data-structure" class="nav-link" data-scroll-target="#examine-the-data-structure">2.2 Examine the Data Structure</a></li>
  <li><a href="#create-time-bins" id="toc-create-time-bins" class="nav-link" data-scroll-target="#create-time-bins">2.3 Create Time Bins</a></li>
  </ul></li>
  <li><a href="#exploratory-analysis" id="toc-exploratory-analysis" class="nav-link" data-scroll-target="#exploratory-analysis">3. Exploratory Analysis</a>
  <ul class="collapse">
  <li><a href="#daily-patterns" id="toc-daily-patterns" class="nav-link" data-scroll-target="#daily-patterns">3.1 Daily Patterns</a></li>
  <li><a href="#hourly-patterns" id="toc-hourly-patterns" class="nav-link" data-scroll-target="#hourly-patterns">3.2 Hourly Patterns</a></li>
  </ul></li>
  <li><a href="#get-philadelphia-spatial-context" id="toc-get-philadelphia-spatial-context" class="nav-link" data-scroll-target="#get-philadelphia-spatial-context">4. Get Philadelphia Spatial Context</a>
  <ul class="collapse">
  <li><a href="#load-philadelphia-census-data" id="toc-load-philadelphia-census-data" class="nav-link" data-scroll-target="#load-philadelphia-census-data">4.1 Load Philadelphia Census Data</a></li>
  <li><a href="#map-philadelphia-context" id="toc-map-philadelphia-context" class="nav-link" data-scroll-target="#map-philadelphia-context">4.2 Map Philadelphia Context</a></li>
  <li><a href="#join-census-data-to-stations" id="toc-join-census-data-to-stations" class="nav-link" data-scroll-target="#join-census-data-to-stations">4.3 Join Census Data to Stations</a></li>
  <li><a href="#dealing-with-missing-data" id="toc-dealing-with-missing-data" class="nav-link" data-scroll-target="#dealing-with-missing-data">4.4Dealing with missing data</a></li>
  </ul></li>
  <li><a href="#get-weather-data" id="toc-get-weather-data" class="nav-link" data-scroll-target="#get-weather-data">5. Get Weather Data</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">5.1 Load Data</a></li>
  <li><a href="#visualize-weather-patterns" id="toc-visualize-weather-patterns" class="nav-link" data-scroll-target="#visualize-weather-patterns">5.2 Visualize Weather Patterns</a></li>
  </ul></li>
  <li><a href="#create-complete-space-time-panel" id="toc-create-complete-space-time-panel" class="nav-link" data-scroll-target="#create-complete-space-time-panel">6. Create Complete Space-Time Panel</a>
  <ul class="collapse">
  <li><a href="#q3-complete-panel" id="toc-q3-complete-panel" class="nav-link" data-scroll-target="#q3-complete-panel">6.1 <strong>2024 Q3 Complete Panel</strong></a></li>
  <li><a href="#q1-complete-panel" id="toc-q1-complete-panel" class="nav-link" data-scroll-target="#q1-complete-panel">6.2 <strong>2025 Q1 Complete Panel</strong></a></li>
  </ul></li>
  <li><a href="#visualize-temporal-patterns" id="toc-visualize-temporal-patterns" class="nav-link" data-scroll-target="#visualize-temporal-patterns">7. Visualize Temporal Patterns</a>
  <ul class="collapse">
  <li><a href="#lag-correlations" id="toc-lag-correlations" class="nav-link" data-scroll-target="#lag-correlations">7.1 Lag Correlations</a></li>
  </ul></li>
  <li><a href="#temporal-traintest-split" id="toc-temporal-traintest-split" class="nav-link" data-scroll-target="#temporal-traintest-split">8. Temporal Train/Test Split</a>
  <ul class="collapse">
  <li><a href="#q3" id="toc-q3" class="nav-link" data-scroll-target="#q3">8.1 2024 Q3</a></li>
  <li><a href="#q1" id="toc-q1" class="nav-link" data-scroll-target="#q1">8.2 2025 Q1</a></li>
  </ul></li>
  <li><a href="#build-predictive-models" id="toc-build-predictive-models" class="nav-link" data-scroll-target="#build-predictive-models">9. Build Predictive Models</a>
  <ul class="collapse">
  <li><a href="#q3-models" id="toc-q3-models" class="nav-link" data-scroll-target="#q3-models">9.1 2024 Q3 Models</a></li>
  <li><a href="#q1-models" id="toc-q1-models" class="nav-link" data-scroll-target="#q1-models">9.2 2025 Q1 Models</a></li>
  <li><a href="#model-performance-comparison" id="toc-model-performance-comparison" class="nav-link" data-scroll-target="#model-performance-comparison">9.3 Model Performance Comparison</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-2-error-analysis" id="toc-part-2-error-analysis" class="nav-link" data-scroll-target="#part-2-error-analysis">PART 2: Error Analysis</a>
  <ul class="collapse">
  <li><a href="#spatial-error-patterns" id="toc-spatial-error-patterns" class="nav-link" data-scroll-target="#spatial-error-patterns">1. Spatial Error Patterns</a></li>
  <li><a href="#temporal-error-patterns" id="toc-temporal-error-patterns" class="nav-link" data-scroll-target="#temporal-error-patterns">2. Temporal Error Patterns</a></li>
  <li><a href="#demographics-error-patterns" id="toc-demographics-error-patterns" class="nav-link" data-scroll-target="#demographics-error-patterns">3. Demographics Error Patterns</a></li>
  </ul></li>
  <li><a href="#part-3-feature-engineering-model-improvement" id="toc-part-3-feature-engineering-model-improvement" class="nav-link" data-scroll-target="#part-3-feature-engineering-model-improvement">PART 3: Feature Engineering &amp; model improvement</a>
  <ul class="collapse">
  <li><a href="#temporal-features-school-calendar" id="toc-temporal-features-school-calendar" class="nav-link" data-scroll-target="#temporal-features-school-calendar">3.1 Temporal features: School calendar</a>
  <ul class="collapse">
  <li><a href="#add-school-feature" id="toc-add-school-feature" class="nav-link" data-scroll-target="#add-school-feature">3.1.1 Add School Feature</a></li>
  <li><a href="#refresh-the-split" id="toc-refresh-the-split" class="nav-link" data-scroll-target="#refresh-the-split">3.1.2 Refresh the Split</a></li>
  <li><a href="#build-model-6-school-features" id="toc-build-model-6-school-features" class="nav-link" data-scroll-target="#build-model-6-school-features">3.1.3 Build Model 6 (+School features)</a></li>
  <li><a href="#evaluate-model-6-school-features" id="toc-evaluate-model-6-school-features" class="nav-link" data-scroll-target="#evaluate-model-6-school-features">3.1.4 Evaluate Model 6 (+School features)</a></li>
  </ul></li>
  <li><a href="#weather-features-weekend-nice-weather-interaction" id="toc-weather-features-weekend-nice-weather-interaction" class="nav-link" data-scroll-target="#weather-features-weekend-nice-weather-interaction">3.2 Weather features: Weekend + nice weather interaction</a>
  <ul class="collapse">
  <li><a href="#add-weather-interaction" id="toc-add-weather-interaction" class="nav-link" data-scroll-target="#add-weather-interaction">3.2.1 Add Weather Interaction</a></li>
  <li><a href="#refresh-the-split-1" id="toc-refresh-the-split-1" class="nav-link" data-scroll-target="#refresh-the-split-1">3.2.2 Refresh the Split</a></li>
  <li><a href="#build-model-7-weather-interaction" id="toc-build-model-7-weather-interaction" class="nav-link" data-scroll-target="#build-model-7-weather-interaction">3.2.3 Build Model 7(+ Weather Interaction)</a></li>
  <li><a href="#evaluate-model-7" id="toc-evaluate-model-7" class="nav-link" data-scroll-target="#evaluate-model-7">3.2.4 Evaluate Model 7</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#删掉了温度" id="toc-删掉了温度" class="nav-link" data-scroll-target="#删掉了温度">删掉了温度</a>
  <ul class="collapse">
  <li><a href="#attempt-for-poisson-model" id="toc-attempt-for-poisson-model" class="nav-link" data-scroll-target="#attempt-for-poisson-model">3.3 Attempt for Poisson Model</a>
  <ul class="collapse">
  <li><a href="#build-model-8-poisson" id="toc-build-model-8-poisson" class="nav-link" data-scroll-target="#build-model-8-poisson">3.3.1 Build Model 8 (Poisson)</a></li>
  <li><a href="#evaluate-model-8" id="toc-evaluate-model-8" class="nav-link" data-scroll-target="#evaluate-model-8">3.3.2 Evaluate Model 8</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-4-critical-reflection" id="toc-part-4-critical-reflection" class="nav-link" data-scroll-target="#part-4-critical-reflection">PART 4: Critical Reflection</a>
  <ul class="collapse">
  <li><a href="#operational-implications" id="toc-operational-implications" class="nav-link" data-scroll-target="#operational-implications"><strong>1. Operational implications:</strong></a></li>
  <li><a href="#equity-considerations" id="toc-equity-considerations" class="nav-link" data-scroll-target="#equity-considerations"><strong>2. Equity considerations:</strong></a></li>
  <li><a href="#model-limitations" id="toc-model-limitations" class="nav-link" data-scroll-target="#model-limitations"><strong>3. Model limitations:</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Space-Time Prediction of Bike Share Demand: Philadelphia Indego</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xinyuan(Christine), Yuqing(Demi) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<section id="part-1-compare-2024-q3-with-2025-q1" class="level1">
<h1>PART 1: Compare 2024 Q3 with 2025 Q1</h1>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">1. Setup</h2>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">1.1 Load libraries</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Census data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Weather data</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(riem)  <span class="co"># For Philadelphia weather from ASOS stations</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># here!</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Get rid of scientific notation. We gotta look good!</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">"LC_TIME"</span>, <span class="st">"English"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ""</code></pre>
</div>
</div>
</section>
<section id="define-themes" class="level3">
<h3 class="anchored" data-anchor-id="define-themes">1.2 Define Themes</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plotTheme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"#D0D0D0"</span>, <span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>mapTheme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'transparent'</span>),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">'cm'</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>palette5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#eff3ff"</span>, <span class="st">"#bdd7e7"</span>, <span class="st">"#6baed6"</span>, <span class="st">"#3182bd"</span>, <span class="st">"#08519c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="set-census-api-key" class="level3">
<h3 class="anchored" data-anchor-id="set-census-api-key">1.3 Set Census API Key</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="st">"42bf8a20a3df1def380f330cf7edad0dd5842ce6"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">install =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="data-import-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-import-preparation">2. Data Import &amp; Preparation</h2>
<section id="load-indego-trip-data" class="level3">
<h3 class="anchored" data-anchor-id="load-indego-trip-data">2.1 Load Indego Trip Data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Q3 2024 data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>indego_q3<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"labs/lab_5/data/indego-trips-2024-q3.csv"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Q1 2025 data</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>indego_q1<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"labs/lab_5/data/indego-trips-2025-q1.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="why-q3" class="level4">
<h4 class="anchored" data-anchor-id="why-q3">Why Q3?</h4>
<ul>
<li><strong>Extreme Seasonal Variation:</strong> This selection allows us to compare “peak season” (Summer) against “off-peak season” (Winter). Comparing to Q1, Q3 represents the warmest months with ideal biking conditions and high leisure activity.<br>
</li>
<li><strong>Model Generalizability:</strong> By training models on two drastically different quarters, we can test whether our predictive features (such as spatial lags or rush-hour indicators) remain robust across different volume levels.<br>
</li>
<li><strong>Behavioral Shifts:</strong> Summer data is more likely to be diverse, which likely includes a mix of commuters, tourists, and recreational riders, whereas winter data isolates the “core user” base—resilient commuters who rely on Indego regardless of the weather.</li>
</ul>
</section>
</section>
<section id="examine-the-data-structure" class="level3">
<h3 class="anchored" data-anchor-id="examine-the-data-structure">2.2 Examine the Data Structure</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>indego_q3<span class="sc">$</span>start_time_obj <span class="ot">&lt;-</span> <span class="fu">mdy_hm</span>(indego_q3<span class="sc">$</span>start_time)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>indego_q1<span class="sc">$</span>start_time_obj <span class="ot">&lt;-</span> <span class="fu">mdy_hm</span>(indego_q1<span class="sc">$</span>start_time)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total Trips"</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Date Range"</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unique Start Stations"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Trip: One Way"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Trip: Round Trip"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bike: Standard"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bike: Electric"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Passholder: Day Pass"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Passholder: Walk-up"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q3_2024 =</span> <span class="fu">c</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(indego_q3),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">format</span>(<span class="fu">min</span>(indego_q3<span class="sc">$</span>start_time_obj), <span class="st">"%Y-%m-%d"</span>), <span class="st">"to"</span>, <span class="fu">format</span>(<span class="fu">max</span>(indego_q3<span class="sc">$</span>start_time_obj), <span class="st">"%Y-%m-%d"</span>)),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(indego_q3<span class="sc">$</span>start_station)),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>trip_route_category <span class="sc">==</span> <span class="st">"One Way"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>trip_route_category <span class="sc">==</span> <span class="st">"Round Trip"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>bike_type <span class="sc">==</span> <span class="st">"standard"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>bike_type <span class="sc">==</span> <span class="st">"electric"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>passholder_type <span class="sc">==</span> <span class="st">"Day Pass"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q3<span class="sc">$</span>passholder_type <span class="sc">==</span> <span class="st">"Walk-up"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q1_2025 =</span> <span class="fu">c</span>(</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(indego_q1),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">format</span>(<span class="fu">min</span>(indego_q1<span class="sc">$</span>start_time_obj), <span class="st">"%Y-%m-%d"</span>), <span class="st">"to"</span>, <span class="fu">format</span>(<span class="fu">max</span>(indego_q1<span class="sc">$</span>start_time_obj), <span class="st">"%Y-%m-%d"</span>)),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(indego_q1<span class="sc">$</span>start_station)),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>trip_route_category <span class="sc">==</span> <span class="st">"One Way"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>trip_route_category <span class="sc">==</span> <span class="st">"Round Trip"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>bike_type <span class="sc">==</span> <span class="st">"standard"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>bike_type <span class="sc">==</span> <span class="st">"electric"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>passholder_type <span class="sc">==</span> <span class="st">"Day Pass"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(indego_q1<span class="sc">$</span>passholder_type <span class="sc">==</span> <span class="st">"Walk-up"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(comparison_df, <span class="at">caption =</span> <span class="st">"Comparison of Indego Q3 2024 vs Q1 2025"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of Indego Q3 2024 vs Q1 2025</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Q3_2024</th>
<th style="text-align: left;">Q1_2025</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Total Trips</td>
<td style="text-align: left;">408408</td>
<td style="text-align: left;">201588</td>
</tr>
<tr class="even">
<td style="text-align: left;">Date Range</td>
<td style="text-align: left;">2024-07-01 to 2024-09-30</td>
<td style="text-align: left;">2025-01-01 to 2025-03-31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unique Start Stations</td>
<td style="text-align: left;">261</td>
<td style="text-align: left;">265</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trip: One Way</td>
<td style="text-align: left;">380939</td>
<td style="text-align: left;">190792</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trip: Round Trip</td>
<td style="text-align: left;">27469</td>
<td style="text-align: left;">10796</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bike: Standard</td>
<td style="text-align: left;">171569</td>
<td style="text-align: left;">72027</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bike: Electric</td>
<td style="text-align: left;">236839</td>
<td style="text-align: left;">129561</td>
</tr>
<tr class="even">
<td style="text-align: left;">Passholder: Day Pass</td>
<td style="text-align: left;">22885</td>
<td style="text-align: left;">5494</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Passholder: Walk-up</td>
<td style="text-align: left;">13308</td>
<td style="text-align: left;">10419</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The system exhibits a sharp seasonal contraction with&nbsp;<strong>total ridership dropping by approximately 50%</strong>&nbsp;(408,408 to 201,588 trips). This decline is disproportionately driven by the loss of leisure and casual users, evidenced by a drastic&nbsp;<strong>76% plummet in Day Pass usage</strong>&nbsp;(22,885 down to 5,494) and a significant reduction in Round Trips. While the physical network remained stable (growing slightly from 261 to 265 stations), the data highlights a persistent user preference for&nbsp;<strong>electric bikes</strong>, which maintained higher usage volumes than standard bikes in both seasons. But it may also be affected by the fleet size of Indego.</p>
</section>
<section id="create-time-bins" class="level3">
<h3 class="anchored" data-anchor-id="create-time-bins">2.3 Create Time Bins</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>panel_q3_base <span class="ot">&lt;-</span> indego_q3 <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parse datetime</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_datetime =</span> <span class="fu">mdy_hm</span>(start_time),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_datetime =</span> <span class="fu">mdy_hm</span>(end_time),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create hourly bins</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval60 =</span> <span class="fu">floor_date</span>(start_datetime, <span class="at">unit =</span> <span class="st">"hour"</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract time features</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">week</span>(interval60),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>), </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dotw =</span> <span class="fu">wday</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(interval60),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(interval60),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create useful indicators</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekend =</span> <span class="fu">ifelse</span>(dotw <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rush_hour =</span> <span class="fu">ifelse</span>(hour <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at temporal features</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(panel_q3_base <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_datetime, interval60, week, dotw, hour, weekend))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  start_datetime      interval60           week dotw   hour weekend
  &lt;dttm&gt;              &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;int&gt;   &lt;dbl&gt;
1 2024-07-01 00:02:00 2024-07-01 00:00:00    27 Mon       0       0
2 2024-07-01 00:03:00 2024-07-01 00:00:00    27 Mon       0       0
3 2024-07-01 00:04:00 2024-07-01 00:00:00    27 Mon       0       0
4 2024-07-01 00:05:00 2024-07-01 00:00:00    27 Mon       0       0
5 2024-07-01 00:06:00 2024-07-01 00:00:00    27 Mon       0       0
6 2024-07-01 00:06:00 2024-07-01 00:00:00    27 Mon       0       0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2024 Q3 Base Panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(panel_q3_base), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"rows</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2024 Q3 Base Panel: 408,408 rows</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>panel_q1_base <span class="ot">&lt;-</span> indego_q1 <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parse datetime</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_datetime =</span> <span class="fu">mdy_hm</span>(start_time),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_datetime =</span> <span class="fu">mdy_hm</span>(end_time),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create hourly bins</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval60 =</span> <span class="fu">floor_date</span>(start_datetime, <span class="at">unit =</span> <span class="st">"hour"</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract time features</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">week</span>(interval60),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">locale =</span> <span class="st">"en_US.UTF-8"</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dotw =</span> <span class="fu">wday</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">locale =</span> <span class="st">"en_US.UTF-8"</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(interval60),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(interval60),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create useful indicators</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekend =</span> <span class="fu">ifelse</span>(dotw <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rush_hour =</span> <span class="fu">ifelse</span>(hour <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at temporal features</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(panel_q1_base <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_datetime, interval60, week, dotw, hour, weekend))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  start_datetime      interval60           week dotw   hour weekend
  &lt;dttm&gt;              &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;int&gt;   &lt;dbl&gt;
1 2025-01-01 00:00:00 2025-01-01 00:00:00     1 Wed       0       0
2 2025-01-01 00:04:00 2025-01-01 00:00:00     1 Wed       0       0
3 2025-01-01 00:05:00 2025-01-01 00:00:00     1 Wed       0       0
4 2025-01-01 00:05:00 2025-01-01 00:00:00     1 Wed       0       0
5 2025-01-01 00:08:00 2025-01-01 00:00:00     1 Wed       0       0
6 2025-01-01 00:14:00 2025-01-01 00:00:00     1 Wed       0       0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2025 Q1 Base Panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(panel_q1_base), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"rows</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2025 Q1 Base Panel: 201,588 rows</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="exploratory-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-analysis">3. Exploratory Analysis</h2>
<section id="daily-patterns" class="level3">
<h3 class="anchored" data-anchor-id="daily-patterns">3.1 Daily Patterns</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily trip counts</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>daily_trips_q3 <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">trips =</span> <span class="fu">n</span>())</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>daily_trips_q3_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_trips_q3, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> trips)) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3182bd"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Indego Daily Ridership - Q3 2024"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summer demand patterns in Philadelphia"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily Trips"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Indego bike share"</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>daily_trips_q1 <span class="ot">&lt;-</span> panel_q1_base <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">trips =</span> <span class="fu">n</span>())</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>daily_trips_q1_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_trips_q1, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> trips)) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3182bd"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Indego Daily Ridership - Q1 2025"</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Winter demand patterns in Philadelphia"</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily Trips"</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Indego bike share"</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>daily_trips_q3_plot <span class="sc">/</span> daily_trips_q1_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/trips_over_time-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We find that <strong>seasonal influence is the dominant driver of ridership patterns</strong>, with distinct behaviors in each quarter:</p>
<ul>
<li><p>Q3 2024 (Summer) shows consistently high demand, fluctuating between&nbsp;<strong>3,000 and 5,000 daily trips</strong>, whereas Q1 2025 (Winter) sees significantly lower activity, ranging from&nbsp;<strong>1,000 to 3,000 trips</strong>.</p></li>
<li><p>Summer ridership remains relatively&nbsp;<strong>stable and flat</strong>&nbsp;across July through September. In contrast, Winter ridership exhibits a clear&nbsp;<strong>upward trend</strong>, starting low in January and gradually increasing as the season transitions toward spring in March.</p></li>
<li><p>Summer displays a regular, rhythmic cycle (likely weekly commute patterns), while Winter demand is highly&nbsp;<strong>volatile with sharp drops</strong>, likely reflecting greater sensitivity to extreme cold or precipitation events.</p></li>
</ul>
</section>
<section id="hourly-patterns" class="level3">
<h3 class="anchored" data-anchor-id="hourly-patterns">3.2 Hourly Patterns</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average trips by hour and day type</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>hourly_patterns_q3 <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour, weekend) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_trips =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">n_distinct</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_type =</span> <span class="fu">ifelse</span>(weekend <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>hourly_trips_q3_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hourly_patterns_q3, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> avg_trips, <span class="at">color =</span> day_type)) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Weekday"</span> <span class="ot">=</span> <span class="st">"#08519c"</span>, <span class="st">"Weekend"</span> <span class="ot">=</span> <span class="st">"#6baed6"</span>)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Hourly Ridership Patterns in 2024 Q3"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Clear commute patterns on weekdays"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Trips per Hour"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Day Type"</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>hourly_patterns_q1 <span class="ot">&lt;-</span> panel_q1_base <span class="sc">%&gt;%</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour, weekend) <span class="sc">%&gt;%</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_trips =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">n_distinct</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_type =</span> <span class="fu">ifelse</span>(weekend <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>))</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>hourly_trips_q1_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hourly_patterns_q1, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> avg_trips, <span class="at">color =</span> day_type)) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Weekday"</span> <span class="ot">=</span> <span class="st">"#08519c"</span>, <span class="st">"Weekend"</span> <span class="ot">=</span> <span class="st">"#6baed6"</span>)) <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Hourly Ridership Patterns in 2025 Q1"</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Clear commute patterns on weekdays"</span>,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Trips per Hour"</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Day Type"</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>hourly_trips_q3_plot <span class="sc">/</span> hourly_trips_q1_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/hourly_patterns-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the hourly ridership charts provided, here is the analysis of peak hours and day-type differences:</p>
<ul>
<li><p>There is a distinct “commuter profile” with two sharp peaks. The morning peak occurs around&nbsp;<strong>8:00 AM</strong>, and the evening peak—which is consistently higher—occurs around&nbsp;<strong>5:00 PM (17:00)</strong>. Instead of sharp spikes, weekends show a single broad plateau where demand peaks in the mid-afternoon, roughly between&nbsp;<strong>12:00 PM and 4:00 PM</strong>.</p></li>
<li><p>Weekdays exhibit a&nbsp;<strong>two-peak</strong>&nbsp;distribution driven by work commutes, whereas weekends follow a&nbsp;<strong>bell-shaped</strong>&nbsp;curve consistent with leisure or errand activity. In&nbsp;<strong>Summer</strong>, weekend demand is robust, with the afternoon plateau hovering near 250-300 trips per hour, nearly matching weekday midday levels.</p></li>
</ul>
<hr>
</section>
</section>
<section id="get-philadelphia-spatial-context" class="level2">
<h2 class="anchored" data-anchor-id="get-philadelphia-spatial-context">4. Get Philadelphia Spatial Context</h2>
<section id="load-philadelphia-census-data" class="level3">
<h3 class="anchored" data-anchor-id="load-philadelphia-census-data">4.1 Load Philadelphia Census Data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Philadelphia census tracts</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>philly_census <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B01003_001"</span>,  <span class="co"># Total population</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B19013_001"</span>,  <span class="co"># Median household income</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B08301_001"</span>,  <span class="co"># Total commuters</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B08301_010"</span>,  <span class="co"># Commute by transit</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_002"</span>,  <span class="co"># White alone</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B25077_001"</span>   <span class="co"># Median home value</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"PA"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> <span class="st">"Philadelphia"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2022</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Pop =</span> B01003_001E,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Med_Inc =</span> B19013_001E,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Commuters =</span> B08301_001E,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Transit_Commuters =</span> B08301_010E,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">White_Pop =</span> B02001_002E,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Med_Home_Value =</span> B25077_001E</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percent_Taking_Transit =</span> (Transit_Commuters <span class="sc">/</span> Total_Commuters) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percent_White =</span> (White_Pop <span class="sc">/</span> Total_Pop) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
</div>
</section>
<section id="map-philadelphia-context" class="level3">
<h3 class="anchored" data-anchor-id="map-philadelphia-context">4.2 Map Philadelphia Context</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map median income</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> philly_census, <span class="fu">aes</span>(<span class="at">fill =</span> Med_Inc), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"viridis"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">Income"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>dollar</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Philadelphia Median Household Income by Census Tract"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Context for understanding bike share demand patterns"</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stations </span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> indego_q3,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> start_lon, <span class="at">y =</span> start_lat),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.25</span>, <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  mapTheme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/map_philly-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The map reveals that Indego stations are heavily clustered within Philadelphia’s core, specifically in Center City and University City, which correspond to the highest median household income tracts. Conversely, the network density drops precipitously in the lower-income neighborhoods of North and West Philadelphia, highlighting a spatial disparity where bike share infrastructure is significantly more accessible to wealthier residents compared to those in economically disadvantaged areas.</p>
</section>
<section id="join-census-data-to-stations" class="level3">
<h3 class="anchored" data-anchor-id="join-census-data-to-stations">4.3 Join Census Data to Stations</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object for stations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>stations_sf_q3 <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_lat), <span class="sc">!</span><span class="fu">is.na</span>(start_lon)) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"start_lon"</span>, <span class="st">"start_lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>stations_sf_q1 <span class="ot">&lt;-</span> panel_q1_base <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_lat), <span class="sc">!</span><span class="fu">is.na</span>(start_lon)) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"start_lon"</span>, <span class="st">"start_lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join to get census tract for each station</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>stations_census_q3 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stations_sf_q3, philly_census, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>stations_census_q1 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stations_sf_q1, philly_census, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the result - investigate whether all of the stations joined to census data -- according to the map above there are stations in non-residential tracts.</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>stations_for_map <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_lat), <span class="sc">!</span><span class="fu">is.na</span>(start_lon)) <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    stations_census_q3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_station, Med_Inc),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">has_census =</span> <span class="sc">!</span><span class="fu">is.na</span>(Med_Inc))</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Add back to trip data</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>indego_census_q3 <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    stations_census_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>             Percent_White, Total_Pop),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>indego_census_q1 <span class="ot">&lt;-</span> panel_q1_base <span class="sc">%&gt;%</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    stations_census_q1 <span class="sc">%&gt;%</span> </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>             Percent_White, Total_Pop),</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for visualization</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>stations_for_map <span class="ot">&lt;-</span> indego_q3 <span class="sc">%&gt;%</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_lat), <span class="sc">!</span><span class="fu">is.na</span>(start_lon)) <span class="sc">%&gt;%</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    stations_census_q3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_station, Med_Inc),</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">has_census =</span> <span class="sc">!</span><span class="fu">is.na</span>(Med_Inc))</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map showing problem stations</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> philly_census, <span class="fu">aes</span>(<span class="at">fill =</span> Med_Inc), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"viridis"</span>,</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">Income"</span>,</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>dollar,</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey90"</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stations with census data (small grey dots)</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> stations_for_map <span class="sc">%&gt;%</span> <span class="fu">filter</span>(has_census),</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> start_lon, <span class="at">y =</span> start_lat),</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey30"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stations WITHOUT census data (red X marks the spot)</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> stations_for_map <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>has_census),</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> start_lon, <span class="at">y =</span> start_lat),</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="fl">1.5</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Philadelphia Median Household Income by Census Tract"</span>,</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Indego stations shown (RED = no census data match)"</span>,</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red X marks indicate stations that didn't join to census tracts"</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>  mapTheme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/join_census_to_stations-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The code performs a&nbsp;<strong>spatial data validation</strong>&nbsp;check. Its main logic is to geometrically link every Indego bike station to its underlying US Census tract to inherit demographic variables (like Median Household Income).</p>
<p>The map acts as a diagnostic tool where the&nbsp;<strong>Red X marks</strong>&nbsp;reveal a “missing data” problem. These specific stations failed to match with a census tract, mostly because they are located on&nbsp;<strong>waterfront piers</strong>&nbsp;or inside&nbsp;<strong>parks/industrial zones</strong>—areas that are non-residential and therefore have no recorded “Median Household Income”. These stations must be excluded from the predictive model because they lack the necessary demographic input data.</p>
</section>
<section id="dealing-with-missing-data" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-missing-data">4.4Dealing with missing data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify which stations to keep</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>valid_stations_q3 <span class="ot">&lt;-</span> stations_census_q3 <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Med_Inc)) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>valid_stations_q1 <span class="ot">&lt;-</span> stations_census_q1 <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Med_Inc)) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter trip data to valid stations only</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>indego_census_q3 <span class="ot">&lt;-</span> panel_q3_base <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_station <span class="sc">%in%</span> valid_stations_q3) <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    stations_census_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>             Percent_White, Total_Pop),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>indego_census_q1 <span class="ot">&lt;-</span> panel_q1_base <span class="sc">%&gt;%</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_station <span class="sc">%in%</span> valid_stations_q1) <span class="sc">%&gt;%</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    stations_census_q1 <span class="sc">%&gt;%</span> </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>             Percent_White, Total_Pop),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="get-weather-data" class="level2">
<h2 class="anchored" data-anchor-id="get-weather-data">5. Get Weather Data</h2>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">5.1 Load Data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get weather from Philadelphia International Airport (KPHL)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This covers Q3 2024: July 1 - September 30</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>weather_data_q3 <span class="ot">&lt;-</span> <span class="fu">riem_measures</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">station =</span> <span class="st">"PHL"</span>,  <span class="co"># Philadelphia International Airport</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_start =</span> <span class="st">"2024-07-01"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_end =</span> <span class="st">"2024-09-30"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Process weather data - FIXED: Aggregating to hourly to prevent duplicate rows</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>weather_processed_q3 <span class="ot">&lt;-</span> weather_data_q3 <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval60 =</span> <span class="fu">floor_date</span>(valid, <span class="at">unit =</span> <span class="st">"hour"</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> tmpf,  <span class="co"># Temperature in Fahrenheit</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Precipitation =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(p01i), <span class="dv">0</span>, p01i),  <span class="co"># Hourly precip in inches</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Wind_Speed =</span> sknt  <span class="co"># Wind speed in knots</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIX: Use summarize instead of distinct to handle multiple readings per hour</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval60) <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> <span class="fu">mean</span>(Temperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Precipitation =</span> <span class="fu">sum</span>(Precipitation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Wind_Speed =</span> <span class="fu">mean</span>(Wind_Speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing hours and interpolate if needed</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>weather_complete_q3 <span class="ot">&lt;-</span> weather_processed_q3 <span class="sc">%&gt;%</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">interval60 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(interval60), <span class="fu">max</span>(interval60), <span class="at">by =</span> <span class="st">"hour"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(Temperature, Precipitation, Wind_Speed, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the weather</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Temperature, Precipitation, Wind_Speed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Temperature    Precipitation        Wind_Speed    
 Min.   :55.00   Min.   :0.000000   Min.   : 0.000  
 1st Qu.:70.00   1st Qu.:0.000000   1st Qu.: 4.000  
 Median :76.00   Median :0.000000   Median : 6.667  
 Mean   :75.96   Mean   :0.009819   Mean   : 6.670  
 3rd Qu.:81.00   3rd Qu.:0.000000   3rd Qu.: 9.000  
 Max.   :98.00   Max.   :2.750100   Max.   :24.000  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This covers Q1 2025: Jan 1 - Mar 31</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>weather_data_q1 <span class="ot">&lt;-</span> <span class="fu">riem_measures</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">station =</span> <span class="st">"PHL"</span>,  <span class="co"># Philadelphia International Airport</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_start =</span> <span class="st">"2025-01-01"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_end =</span> <span class="st">"2025-03-31"</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Process weather data - FIXED: Aggregating to hourly to prevent duplicate rows</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>weather_processed_q1 <span class="ot">&lt;-</span> weather_data_q1 <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval60 =</span> <span class="fu">floor_date</span>(valid, <span class="at">unit =</span> <span class="st">"hour"</span>),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> tmpf,  <span class="co"># Temperature in Fahrenheit</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Precipitation =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(p01i), <span class="dv">0</span>, p01i),  <span class="co"># Hourly precip in inches</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Wind_Speed =</span> sknt  <span class="co"># Wind speed in knots</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIX: Use summarize instead of distinct to handle multiple readings per hour</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval60) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temperature =</span> <span class="fu">mean</span>(Temperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Precipitation =</span> <span class="fu">sum</span>(Precipitation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Wind_Speed =</span> <span class="fu">mean</span>(Wind_Speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing hours and interpolate if needed</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>weather_complete_q1 <span class="ot">&lt;-</span> weather_processed_q1 <span class="sc">%&gt;%</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">interval60 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(interval60), <span class="fu">max</span>(interval60), <span class="at">by =</span> <span class="st">"hour"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(Temperature, Precipitation, Wind_Speed, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the weather</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather_complete_q1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Temperature, Precipitation, Wind_Speed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Temperature    Precipitation        Wind_Speed    
 Min.   :10.00   Min.   :0.000000   Min.   : 0.000  
 1st Qu.:30.00   1st Qu.:0.000000   1st Qu.: 5.625  
 Median :37.00   Median :0.000000   Median : 8.000  
 Mean   :38.35   Mean   :0.006774   Mean   : 9.329  
 3rd Qu.:46.00   3rd Qu.:0.000000   3rd Qu.:13.000  
 Max.   :78.00   Max.   :1.240100   Max.   :30.000  </code></pre>
</div>
</div>
</section>
<section id="visualize-weather-patterns" class="level3">
<h3 class="anchored" data-anchor-id="visualize-weather-patterns">5.2 Visualize Weather Patterns</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>weather_q3_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(weather_complete_q3, <span class="fu">aes</span>(<span class="at">x =</span> interval60, <span class="at">y =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3182bd"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Philadelphia Temperature - 2024 Q3"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summer to early autumn transition"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Temperature (°F)"</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>weather_q1_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(weather_complete_q1, <span class="fu">aes</span>(<span class="at">x =</span> interval60, <span class="at">y =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3182bd"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Philadelphia Temperature - 2025 Q1"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Winter to early spring transition"</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Temperature (°F)"</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>weather_q3_plot <span class="sc">/</span> weather_q1_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/visualize_weather-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the temperature plots, the two quarters exhibit distinct thermal profiles:</p>
<ul>
<li><p>Summer (Q3 2024) temperatures are consistently high and stable, fluctuating regularly between&nbsp;<strong>70°F and 90°F</strong>&nbsp;with a slight cooling trend as autumn approaches. Winter (Q1 2025) shows a clear&nbsp;<strong>upward warming trend</strong>, starting with freezing lows (dipping near 20°F) in January and rising to milder spring temperatures (peaks near 70°F) by late March.</p></li>
<li><p>The winter plot reveals sharper volatility, including a notable&nbsp;<strong>cold snap in late January</strong>&nbsp;where temperatures plummeted significantly, whereas summer follows a more predictable daily cycle.</p></li>
</ul>
<hr>
</section>
</section>
<section id="create-complete-space-time-panel" class="level2">
<h2 class="anchored" data-anchor-id="create-complete-space-time-panel">6. Create Complete Space-Time Panel</h2>
<p>This code constructs the complete&nbsp;<strong>space-time panel dataset</strong>&nbsp;required for modeling. It first aggregates raw trip data into hourly counts and joins this to a full grid of all possible station-hour combinations, ensuring that periods with no ridership are explicitly recorded as&nbsp;<strong>zeros</strong>&nbsp;rather than missing values. The dataset is then enriched with&nbsp;<strong>temporal features</strong>&nbsp;(e.g., rush hour flags),&nbsp;<strong>weather data</strong>, and&nbsp;<strong>census demographics</strong>, before calculating&nbsp;<strong>lag variables</strong>&nbsp;(demand from 1, 3, and 24 hours ago) to allow the model to use recent history as a predictor.</p>
<section id="q3-complete-panel" class="level3">
<h3 class="anchored" data-anchor-id="q3-complete-panel">6.1 <strong>2024 Q3 Complete Panel</strong></h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.Aggregate Trips to Station-Hour Level</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count trips by station-hour</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>trips_panel_q3 <span class="ot">&lt;-</span> indego_census_q3 <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval60, start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Trip_Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create Complete Panel Structure</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate expected panel size</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Q3 2024 (July, Aug, Sept) has 92 days. 92 * 24 = 2208 hours.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>n_stations <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(trips_panel_q3<span class="sc">$</span>start_station))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual set Q3 time range to ensure we capture ALL hours, even if no trips happened</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>q3_start <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2024-07-01 00:00:00"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>q3_end   <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2024-09-30 23:00:00"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>full_time_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> q3_start, <span class="at">to =</span> q3_end, <span class="at">by =</span> <span class="st">"1 hour"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>n_hours <span class="ot">&lt;-</span> <span class="fu">length</span>(full_time_seq)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>expected_rows_q3 <span class="ot">&lt;-</span> n_stations <span class="sc">*</span> n_hours</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Expected panel rows:"</span>, <span class="fu">format</span>(expected_rows_q3, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Expected panel rows: 532,128 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Current rows in trips_panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(trips_panel_q3), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Current rows in trips_panel: 193,072 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete panel</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval60 =</span> full_time_seq,               <span class="co"># Use the full explicit time sequence</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_station =</span> <span class="fu">unique</span>(trips_panel_q3<span class="sc">$</span>start_station)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join trip counts (this will generate NAs for hours with no trips)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trips_panel_q3, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"interval60"</span>, <span class="st">"start_station"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA trip counts with 0 (Crucial step!)</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trip_Count =</span> <span class="fu">replace_na</span>(Trip_Count, <span class="dv">0</span>))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Join attributes back to the main expanded panel</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: We select specific columns from study_panel_q3 to avoid duplicate attribute columns before joining</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    stations_census_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, Percent_White, Total_Pop),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify we have complete panel</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Complete panel rows Q3:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(study_panel_q3), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete panel rows Q3: 532,128 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add Time Features</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">week</span>(interval60),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dotw =</span> <span class="fu">wday</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(interval60),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(interval60),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekend =</span> <span class="fu">ifelse</span>(dotw <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rush_hour =</span> <span class="fu">ifelse</span>(hour <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Join Weather Data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weather_complete_q3, <span class="at">by =</span> <span class="st">"interval60"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(study_panel_q3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Trip_Count, Temperature, Precipitation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Trip_Count      Temperature    Precipitation   
 Min.   : 0.000   Min.   :55.00   Min.   :0.0000  
 1st Qu.: 0.000   1st Qu.:70.00   1st Qu.:0.0000  
 Median : 0.000   Median :76.00   Median :0.0000  
 Mean   : 0.722   Mean   :75.96   Mean   :0.0098  
 3rd Qu.: 1.000   3rd Qu.:81.00   3rd Qu.:0.0000  
 Max.   :24.000   Max.   :98.00   Max.   :2.7501  
                  NA's   :5784    NA's   :5784    </code></pre>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create Temporal Lag Variables</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by station and time</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(start_station, interval60)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create lag variables WITHIN each station</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>study_panel_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag1Hour =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">1</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag2Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">2</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag3Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">3</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag12Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">12</span>),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag1day =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">24</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with NA lags (first 24 hours for each station)</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q3 <span class="ot">&lt;-</span> study_panel_q3 <span class="sc">%&gt;%</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lag1day))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Final 2024 Q3 Panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(study_panel_complete_q3), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Final 2024 Q3 Panel: 526,344 </code></pre>
</div>
</div>
</section>
<section id="q1-complete-panel" class="level3">
<h3 class="anchored" data-anchor-id="q1-complete-panel">6.2 <strong>2025 Q1 Complete Panel</strong></h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.Aggregate Trips to Station-Hour Level</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count trips by station-hour</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>trips_panel_q1 <span class="ot">&lt;-</span> indego_census_q1 <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(interval60, start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Trip_Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create Complete Panel Structure</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate expected panel size</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>n_stations <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(trips_panel_q1<span class="sc">$</span>start_station))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual set Q1 2025 time range to ensure we capture ALL hours</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Q1 is Jan 1 to Mar 31</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>q1_start <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2025-01-01 00:00:00"</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>q1_end   <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2025-03-31 23:00:00"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Force generate a complete hourly sequence</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>full_time_seq_q1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> q1_start, <span class="at">to =</span> q1_end, <span class="at">by =</span> <span class="st">"1 hour"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>n_hours <span class="ot">&lt;-</span> <span class="fu">length</span>(full_time_seq_q1)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>expected_rows_q1 <span class="ot">&lt;-</span> n_stations <span class="sc">*</span> n_hours</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Expected panel rows Q1:"</span>, <span class="fu">format</span>(expected_rows_q1, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Expected panel rows Q1: 529,200 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Current rows in trips_panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(trips_panel_q1), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Current rows in trips_panel: 116,718 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete panel</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval60 =</span> full_time_seq_q1,            <span class="co"># Use the full explicit time sequence</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_station =</span> <span class="fu">unique</span>(trips_panel_q1<span class="sc">$</span>start_station)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join trip counts</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trips_panel_q1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"interval60"</span>, <span class="st">"start_station"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA trip counts with 0 (Crucial step!)</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trip_Count =</span> <span class="fu">replace_na</span>(Trip_Count, <span class="dv">0</span>))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Join attributes back to the main expanded panel</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use select to ensure we don't duplicate columns</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    stations_census_q1 <span class="sc">%&gt;%</span> </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, Percent_White, Total_Pop),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify we have complete panel</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Complete panel rows Q1:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(study_panel_q1), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Complete panel rows Q1: 529,200 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add Time Features</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">week</span>(interval60),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dotw =</span> <span class="fu">wday</span>(interval60, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(interval60),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(interval60),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekend =</span> <span class="fu">ifelse</span>(dotw <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>, <span class="st">"Sun"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rush_hour =</span> <span class="fu">ifelse</span>(hour <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Join Weather Data</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weather_complete_q1, <span class="at">by =</span> <span class="st">"interval60"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(study_panel_q1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Trip_Count, Temperature, Precipitation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Trip_Count       Temperature    Precipitation   
 Min.   : 0.0000   Min.   :10.00   Min.   :0.0000  
 1st Qu.: 0.0000   1st Qu.:30.00   1st Qu.:0.0000  
 Median : 0.0000   Median :37.00   Median :0.0000  
 Mean   : 0.3569   Mean   :38.35   Mean   :0.0068  
 3rd Qu.: 0.0000   3rd Qu.:46.00   3rd Qu.:0.0000  
 Max.   :26.0000   Max.   :78.00   Max.   :1.2401  
                   NA's   :5880    NA's   :5880    </code></pre>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create Temporal Lag Variables</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by station and time</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(start_station, interval60)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create lag variables WITHIN each station</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>study_panel_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag1Hour =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">1</span>),</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag2Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">2</span>),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag3Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">3</span>),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag12Hours =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">12</span>),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag1day =</span> <span class="fu">lag</span>(Trip_Count, <span class="dv">24</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with NA lags (first 24 hours for each station)</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q1 <span class="ot">&lt;-</span> study_panel_q1 <span class="sc">%&gt;%</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lag1day))</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Final 2025 Q1 Panel:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(study_panel_complete_q1), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Final 2025 Q1 Panel: 523,320 </code></pre>
</div>
</div>
</section>
</section>
<section id="visualize-temporal-patterns" class="level2">
<h2 class="anchored" data-anchor-id="visualize-temporal-patterns">7. Visualize Temporal Patterns</h2>
<section id="lag-correlations" class="level3">
<h3 class="anchored" data-anchor-id="lag-correlations">7.1 Lag Correlations</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample one station to visualize</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>example_station <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_station <span class="sc">==</span> <span class="fu">first</span>(start_station)) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">168</span>)  <span class="co"># One week</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot actual vs lagged demand</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(example_station, <span class="fu">aes</span>(<span class="at">x =</span> interval60)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Trip_Count, <span class="at">color =</span> <span class="st">"Current"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> lag1Hour, <span class="at">color =</span> <span class="st">"1 Hour Ago"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> lag1day, <span class="at">color =</span> <span class="st">"24 Hours Ago"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Current"</span> <span class="ot">=</span> <span class="st">"#08519c"</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1 Hour Ago"</span> <span class="ot">=</span> <span class="st">"#3182bd"</span>,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"24 Hours Ago"</span> <span class="ot">=</span> <span class="st">"#6baed6"</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Temporal Lag Patterns at One Station"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Past demand predicts future demand"</span>,</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date-Time"</span>,</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Trip Count"</span>,</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  plotTheme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/lag_correlations-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This visualization confirms the strong&nbsp;<strong>temporal autocorrelation</strong>&nbsp;inherent in bike share data. By overlaying current trip counts (dark blue) with demand from the previous hour and the previous day, we observe a distinct, repetitive daily rhythm. The close alignment between the “Current” trend and the “24 Hours Ago” line demonstrates that demand is highly cyclical, with peaks recurring at similar times each day. This visual evidence validates the decision to engineer&nbsp;<strong>lag features</strong>&nbsp;for the predictive model, proving that historical usage (particularly the previous day’s pattern) is a powerful predictor of future demand.</p>
<hr>
</section>
</section>
<section id="temporal-traintest-split" class="level2">
<h2 class="anchored" data-anchor-id="temporal-traintest-split">8. Temporal Train/Test Split</h2>
<section id="q3" class="level3">
<h3 class="anchored" data-anchor-id="q3">8.1 2024 Q3</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Q3 has weeks 27-40 (Jul-Sep)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Train on weeks 27-35 (Jul 1 - early September)</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test on weeks 36-40 (rest of September)</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(study_panel_complete_q3<span class="sc">$</span>week)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 27 28 29 30 31 32 33 34 35 36 37 38 39 40</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Which stations have trips in BOTH early and late periods?</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>early_stations_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">36</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trip_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>late_stations_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">36</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trip_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only stations that appear in BOTH periods</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>common_stations_q3 <span class="ot">&lt;-</span> <span class="fu">intersect</span>(early_stations_q3, late_stations_q3)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter panel to only common stations</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_station <span class="sc">%in%</span> common_stations_q3)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co"># NOW create train/test split</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">36</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">36</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training observations Q3:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(train_q3), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training observations Q3: 349,680 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Testing observations Q3:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(test_q3), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Testing observations Q3: 163,560 </code></pre>
</div>
</div>
</section>
<section id="q1" class="level3">
<h3 class="anchored" data-anchor-id="q1">8.2 2025 Q1</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train on weeks 1-9 (Jan 1 - early March)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test on weeks 10-13 (rest of March)</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(study_panel_complete_q1<span class="sc">$</span>week)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Which stations have trips in BOTH early and late periods?</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>early_stations_q1 <span class="ot">&lt;-</span> study_panel_complete_q1 <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trip_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>late_stations_q1 <span class="ot">&lt;-</span> study_panel_complete_q1 <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trip_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_station) <span class="sc">%&gt;%</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(start_station)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only stations that appear in BOTH periods</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>common_stations_q1 <span class="ot">&lt;-</span> <span class="fu">intersect</span>(early_stations_q1, late_stations_q1)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter panel to only common stations</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q1 <span class="ot">&lt;-</span> study_panel_complete_q1 <span class="sc">%&gt;%</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_station <span class="sc">%in%</span> common_stations_q1)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co"># NOW create train/test split</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>train_q1 <span class="ot">&lt;-</span> study_panel_complete_q1 <span class="sc">%&gt;%</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">10</span>)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>test_q1 <span class="ot">&lt;-</span> study_panel_complete_q1 <span class="sc">%&gt;%</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">10</span>)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training observations Q1:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(train_q1), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training observations Q1: 354,144 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Testing observations Q1:"</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(test_q1), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Testing observations Q1: 154,224 </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="build-predictive-models" class="level2">
<h2 class="anchored" data-anchor-id="build-predictive-models">9. Build Predictive Models</h2>
<section id="q3-models" class="level3">
<h3 class="anchored" data-anchor-id="q3-models">9.1 2024 Q3 Models</h3>
<section id="model-1-baseline-time-weather" class="level4">
<h4 class="anchored" data-anchor-id="model-1-baseline-time-weather">Model 1: Baseline (Time + Weather)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day of week factor with treatment (dummy) coding</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> train_q3 <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts to treatment coding (dummy variables)</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(train_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now run the model</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>model1_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Trip_Count ~ as.factor(hour) + dotw_simple + Temperature + 
    Precipitation, data = train_q3)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.7222 -0.7872 -0.1954  0.1871 23.4121 

Coefficients:
                    Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)        0.3940977  0.0335506  11.746 &lt; 0.0000000000000002 ***
as.factor(hour)1  -0.0977139  0.0144193  -6.777      0.0000000000123 ***
as.factor(hour)2  -0.1340615  0.0144109  -9.303 &lt; 0.0000000000000002 ***
as.factor(hour)3  -0.1867155  0.0144452 -12.926 &lt; 0.0000000000000002 ***
as.factor(hour)4  -0.1748870  0.0144752 -12.082 &lt; 0.0000000000000002 ***
as.factor(hour)5  -0.0481245  0.0145117  -3.316             0.000912 ***
as.factor(hour)6   0.2138134  0.0145495  14.696 &lt; 0.0000000000000002 ***
as.factor(hour)7   0.4927407  0.0145725  33.813 &lt; 0.0000000000000002 ***
as.factor(hour)8   0.8922681  0.0146149  61.052 &lt; 0.0000000000000002 ***
as.factor(hour)9   0.6469687  0.0146375  44.199 &lt; 0.0000000000000002 ***
as.factor(hour)10  0.5327485  0.0145974  36.496 &lt; 0.0000000000000002 ***
as.factor(hour)11  0.5624303  0.0145101  38.761 &lt; 0.0000000000000002 ***
as.factor(hour)12  0.6732015  0.0144185  46.690 &lt; 0.0000000000000002 ***
as.factor(hour)13  0.6935212  0.0143758  48.242 &lt; 0.0000000000000002 ***
as.factor(hour)14  0.7445912  0.0143807  51.777 &lt; 0.0000000000000002 ***
as.factor(hour)15  0.8279830  0.0144296  57.381 &lt; 0.0000000000000002 ***
as.factor(hour)16  1.0219626  0.0144734  70.610 &lt; 0.0000000000000002 ***
as.factor(hour)17  1.3858030  0.0145355  95.339 &lt; 0.0000000000000002 ***
as.factor(hour)18  1.1083174  0.0145778  76.028 &lt; 0.0000000000000002 ***
as.factor(hour)19  0.8919309  0.0145886  61.139 &lt; 0.0000000000000002 ***
as.factor(hour)20  0.6268454  0.0145857  42.977 &lt; 0.0000000000000002 ***
as.factor(hour)21  0.4128159  0.0145127  28.445 &lt; 0.0000000000000002 ***
as.factor(hour)22  0.3157927  0.0144556  21.846 &lt; 0.0000000000000002 ***
as.factor(hour)23  0.1548512  0.0143958  10.757 &lt; 0.0000000000000002 ***
dotw_simple2       0.0735856  0.0079434   9.264 &lt; 0.0000000000000002 ***
dotw_simple3       0.0751295  0.0079782   9.417 &lt; 0.0000000000000002 ***
dotw_simple4       0.0468697  0.0079654   5.884      0.0000000040045 ***
dotw_simple5      -0.0473784  0.0079563  -5.955      0.0000000026056 ***
dotw_simple6      -0.0653380  0.0079484  -8.220 &lt; 0.0000000000000002 ***
dotw_simple7      -0.1227242  0.0079501 -15.437 &lt; 0.0000000000000002 ***
Temperature       -0.0018760  0.0003914  -4.793      0.0000016451977 ***
Precipitation     -0.0535064  0.0174455  -3.067             0.002162 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.227 on 349648 degrees of freedom
Multiple R-squared:  0.1116,    Adjusted R-squared:  0.1115 
F-statistic:  1417 on 31 and 349648 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-2-add-temporal-lags" class="level4">
<h4 class="anchored" data-anchor-id="model-2-add-temporal-lags">Model 2: Add Temporal Lags</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model2_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Trip_Count ~ as.factor(hour) + dotw_simple + Temperature + 
    Precipitation + lag1Hour + lag3Hours + lag1day, data = train_q3)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.2148 -0.5344 -0.1526  0.2223 21.4940 

Coefficients:
                    Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)        0.1160760  0.0296289   3.918  0.00008943093627569 ***
as.factor(hour)1  -0.0274986  0.0127286  -2.160             0.030744 *  
as.factor(hour)2  -0.0081186  0.0127275  -0.638             0.523554    
as.factor(hour)3  -0.0206389  0.0127662  -1.617             0.105947    
as.factor(hour)4   0.0099397  0.0128002   0.777             0.437438    
as.factor(hour)5   0.1009008  0.0128356   7.861  0.00000000000000382 ***
as.factor(hour)6   0.2677691  0.0128830  20.785 &lt; 0.0000000000000002 ***
as.factor(hour)7   0.4049385  0.0129270  31.325 &lt; 0.0000000000000002 ***
as.factor(hour)8   0.6122588  0.0130130  47.050 &lt; 0.0000000000000002 ***
as.factor(hour)9   0.3103126  0.0130032  23.864 &lt; 0.0000000000000002 ***
as.factor(hour)10  0.2548051  0.0129193  19.723 &lt; 0.0000000000000002 ***
as.factor(hour)11  0.2592292  0.0128474  20.178 &lt; 0.0000000000000002 ***
as.factor(hour)12  0.3607666  0.0127686  28.254 &lt; 0.0000000000000002 ***
as.factor(hour)13  0.3604016  0.0127400  28.289 &lt; 0.0000000000000002 ***
as.factor(hour)14  0.3901808  0.0127504  30.601 &lt; 0.0000000000000002 ***
as.factor(hour)15  0.4246068  0.0128060  33.157 &lt; 0.0000000000000002 ***
as.factor(hour)16  0.5440485  0.0128779  42.247 &lt; 0.0000000000000002 ***
as.factor(hour)17  0.7549667  0.0130153  58.006 &lt; 0.0000000000000002 ***
as.factor(hour)18  0.4587761  0.0130465  35.165 &lt; 0.0000000000000002 ***
as.factor(hour)19  0.3460763  0.0129926  26.636 &lt; 0.0000000000000002 ***
as.factor(hour)20  0.1607276  0.0129834  12.379 &lt; 0.0000000000000002 ***
as.factor(hour)21  0.1050185  0.0128607   8.166  0.00000000000000032 ***
as.factor(hour)22  0.1110356  0.0127829   8.686 &lt; 0.0000000000000002 ***
as.factor(hour)23  0.0497331  0.0127111   3.913  0.00009134129697993 ***
dotw_simple2       0.0119189  0.0070139   1.699             0.089260 .  
dotw_simple3      -0.0048842  0.0070478  -0.693             0.488309    
dotw_simple4      -0.0256755  0.0070366  -3.649             0.000263 ***
dotw_simple5      -0.0795199  0.0070293 -11.313 &lt; 0.0000000000000002 ***
dotw_simple6      -0.0651468  0.0070181  -9.283 &lt; 0.0000000000000002 ***
dotw_simple7      -0.1012308  0.0070217 -14.417 &lt; 0.0000000000000002 ***
Temperature       -0.0008822  0.0003455  -2.553             0.010674 *  
Precipitation      0.0419172  0.0154082   2.720             0.006520 ** 
lag1Hour           0.2395396  0.0016301 146.948 &lt; 0.0000000000000002 ***
lag3Hours          0.1140298  0.0015873  71.839 &lt; 0.0000000000000002 ***
lag1day            0.2736878  0.0016027 170.763 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.083 on 349645 degrees of freedom
Multiple R-squared:  0.308, Adjusted R-squared:  0.3079 
F-statistic:  4576 on 34 and 349645 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><strong>Question:</strong> Did adding lags improve R²? Why or why not?</p>
</section>
<section id="model-3-add-demographics" class="level4">
<h4 class="anchored" data-anchor-id="model-3-add-demographics">Model 3: Add Demographics</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model3_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary too long with all station dummies, just show key metrics</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 3 R-squared:"</span>, <span class="fu">summary</span>(model3_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 3 R-squared: 0.3142151 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 3 Adj R-squared:"</span>, <span class="fu">summary</span>(model3_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 3 Adj R-squared: 0.3141425 </code></pre>
</div>
</div>
</section>
<section id="model-4-add-station-fixed-effects" class="level4">
<h4 class="anchored" data-anchor-id="model-4-add-station-fixed-effects">Model 4: Add Station Fixed Effects</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>model4_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary too long with all station dummies, just show key metrics</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 4 R-squared:"</span>, <span class="fu">summary</span>(model4_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 4 R-squared: 0.3434496 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 4 Adj R-squared:"</span>, <span class="fu">summary</span>(model4_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 4 Adj R-squared: 0.342946 </code></pre>
</div>
</div>
<p><strong>What do station fixed effects capture?</strong> Baseline differences in demand across stations (some are just busier than others!).</p>
</section>
<section id="model-5-add-rush-hour-interaction" class="level4">
<h4 class="anchored" data-anchor-id="model-5-add-rush-hour-interaction">Model 5: Add Rush Hour Interaction</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>model5_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span> rush_hour <span class="sc">+</span> <span class="fu">as.factor</span>(month) <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    rush_hour <span class="sc">*</span> weekend,  <span class="co"># Rush hour effects different on weekends</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 5 R-squared:"</span>, <span class="fu">summary</span>(model5_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 5 R-squared: 0.3479645 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 5 Adj R-squared:"</span>, <span class="fu">summary</span>(model5_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 5 Adj R-squared: 0.3474588 </code></pre>
</div>
</div>
</section>
<section id="model-performance-summary-training-set" class="level4">
<h4 class="anchored" data-anchor-id="model-performance-summary-training-set">Model performance summary (training set)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>model_rsq_q3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">paste0</span>(<span class="st">"Model "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"Time + Weather"</span>, <span class="st">"+ Temporal Lags"</span>, <span class="st">"+ Demographics"</span>, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"+ Station Fixed Effects"</span>, <span class="st">"+ Rush Hour Interaction"</span>),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model1_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model2_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model3_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model4_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model5_q3)<span class="sc">$</span>r.squared</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(model_rsq_q3,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"2024 Q3 Model Performance"</span>,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Description"</span>, <span class="st">"R²"</span>),</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>2024 Q3 Model Performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R²</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1</td>
<td style="text-align: left;">Time + Weather</td>
<td style="text-align: right;">0.112</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 2</td>
<td style="text-align: left;">+ Temporal Lags</td>
<td style="text-align: right;">0.308</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 3</td>
<td style="text-align: left;">+ Demographics</td>
<td style="text-align: right;">0.314</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 4</td>
<td style="text-align: left;">+ Station Fixed Effects</td>
<td style="text-align: right;">0.343</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 5</td>
<td style="text-align: left;">+ Rush Hour Interaction</td>
<td style="text-align: right;">0.348</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="model-evaluation-summary-test-set" class="level4">
<h4 class="anchored" data-anchor-id="model-evaluation-summary-test-set">Model Evaluation Summary (test set)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day of week factor with treatment (dummy) coding</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts to treatment coding (dummy variables)</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(test_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred1 =</span> <span class="fu">predict</span>(model1_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred2 =</span> <span class="fu">predict</span>(model2_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred3 =</span> <span class="fu">predict</span>(model3_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred4 =</span> <span class="fu">predict</span>(model4_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred5 =</span> <span class="fu">predict</span>(model5_q3, <span class="at">newdata =</span> test_q3)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MAE for each model</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>mae_results_q3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">paste0</span>(<span class="st">"Model "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"Time + Weather"</span>, <span class="st">"+ Temporal Lags"</span>, <span class="st">"+ Demographics"</span>, </span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"+ Station Fixed Effects"</span>, <span class="st">"+ Rush Hour Interaction"</span>),</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE_q3 =</span> <span class="fu">c</span>(</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred1), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred5), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mae_results_q3, </span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"2024 Q3 Model Evaluation"</span>,</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>,<span class="st">"Description"</span>, <span class="st">"MAE"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>2024 Q3 Model Evaluation</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1</td>
<td style="text-align: left;">Time + Weather</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 2</td>
<td style="text-align: left;">+ Temporal Lags</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 3</td>
<td style="text-align: left;">+ Demographics</td>
<td style="text-align: right;">0.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 4</td>
<td style="text-align: left;">+ Station Fixed Effects</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 5</td>
<td style="text-align: left;">+ Rush Hour Interaction</td>
<td style="text-align: right;">0.71</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="q1-models" class="level3">
<h3 class="anchored" data-anchor-id="q1-models">9.2 2025 Q1 Models</h3>
<section id="model-1-baseline-time-weather-1" class="level4">
<h4 class="anchored" data-anchor-id="model-1-baseline-time-weather-1">Model 1: Baseline (Time + Weather)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day of week factor with treatment (dummy) coding</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>train_q1 <span class="ot">&lt;-</span> train_q1 <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts to treatment coding (dummy variables)</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(train_q1<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now run the model</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>model1_q1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q1</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Trip_Count ~ as.factor(hour) + dotw_simple + Temperature + 
    Precipitation, data = train_q1)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.9571 -0.3981 -0.1761  0.0246 18.5345 

Coefficients:
                   Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)       -0.186083   0.008656 -21.497 &lt; 0.0000000000000002 ***
as.factor(hour)1  -0.022170   0.008662  -2.560              0.01048 *  
as.factor(hour)2  -0.038425   0.008665  -4.435 0.000009223337239405 ***
as.factor(hour)3  -0.051750   0.008669  -5.969 0.000000002382143657 ***
as.factor(hour)4  -0.040250   0.008675  -4.640 0.000003491064081685 ***
as.factor(hour)5   0.022443   0.008680   2.586              0.00972 ** 
as.factor(hour)6   0.173092   0.008688  19.924 &lt; 0.0000000000000002 ***
as.factor(hour)7   0.323218   0.008691  37.190 &lt; 0.0000000000000002 ***
as.factor(hour)8   0.549242   0.008694  63.175 &lt; 0.0000000000000002 ***
as.factor(hour)9   0.388029   0.008696  44.622 &lt; 0.0000000000000002 ***
as.factor(hour)10  0.279833   0.008700  32.164 &lt; 0.0000000000000002 ***
as.factor(hour)11  0.297059   0.008703  34.134 &lt; 0.0000000000000002 ***
as.factor(hour)12  0.367753   0.008691  42.314 &lt; 0.0000000000000002 ***
as.factor(hour)13  0.347729   0.008672  40.100 &lt; 0.0000000000000002 ***
as.factor(hour)14  0.351219   0.008662  40.548 &lt; 0.0000000000000002 ***
as.factor(hour)15  0.406504   0.008664  46.917 &lt; 0.0000000000000002 ***
as.factor(hour)16  0.488703   0.008668  56.379 &lt; 0.0000000000000002 ***
as.factor(hour)17  0.620476   0.008676  71.520 &lt; 0.0000000000000002 ***
as.factor(hour)18  0.423784   0.008687  48.786 &lt; 0.0000000000000002 ***
as.factor(hour)19  0.270369   0.008693  31.104 &lt; 0.0000000000000002 ***
as.factor(hour)20  0.153548   0.008685  17.679 &lt; 0.0000000000000002 ***
as.factor(hour)21  0.090346   0.008678  10.411 &lt; 0.0000000000000002 ***
as.factor(hour)22  0.069686   0.008668   8.039 0.000000000000000905 ***
as.factor(hour)23  0.045265   0.008661   5.227 0.000000172769575175 ***
dotw_simple2       0.053398   0.004640  11.509 &lt; 0.0000000000000002 ***
dotw_simple3       0.059407   0.004803  12.370 &lt; 0.0000000000000002 ***
dotw_simple4       0.033142   0.004647   7.131 0.000000000000995308 ***
dotw_simple5       0.044776   0.004642   9.646 &lt; 0.0000000000000002 ***
dotw_simple6      -0.063711   0.004641 -13.728 &lt; 0.0000000000000002 ***
dotw_simple7      -0.059444   0.004669 -12.731 &lt; 0.0000000000000002 ***
Temperature        0.007989   0.000153  52.200 &lt; 0.0000000000000002 ***
Precipitation     -1.125949   0.058754 -19.164 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7438 on 354112 degrees of freedom
Multiple R-squared:  0.0801,    Adjusted R-squared:  0.08002 
F-statistic: 994.6 on 31 and 354112 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-2-add-temporal-lags-1" class="level4">
<h4 class="anchored" data-anchor-id="model-2-add-temporal-lags-1">Model 2: Add Temporal Lags</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model2_q1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q1</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2_q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Trip_Count ~ as.factor(hour) + dotw_simple + Temperature + 
    Precipitation + lag1Hour + lag3Hours + lag1day, data = train_q1)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.9320 -0.2812 -0.0997  0.0182 17.8035 

Coefficients:
                    Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)       -0.0962851  0.0079137 -12.167 &lt; 0.0000000000000002 ***
as.factor(hour)1  -0.0062075  0.0079108  -0.785              0.43264    
as.factor(hour)2  -0.0076621  0.0079144  -0.968              0.33299    
as.factor(hour)3  -0.0102415  0.0079194  -1.293              0.19594    
as.factor(hour)4   0.0051558  0.0079260   0.650              0.51538    
as.factor(hour)5   0.0524781  0.0079312   6.617      0.0000000000368 ***
as.factor(hour)6   0.1554233  0.0079441  19.565 &lt; 0.0000000000000002 ***
as.factor(hour)7   0.2350093  0.0079592  29.527 &lt; 0.0000000000000002 ***
as.factor(hour)8   0.3679467  0.0079919  46.040 &lt; 0.0000000000000002 ***
as.factor(hour)9   0.1779574  0.0079899  22.273 &lt; 0.0000000000000002 ***
as.factor(hour)10  0.1162892  0.0079704  14.590 &lt; 0.0000000000000002 ***
as.factor(hour)11  0.1318394  0.0079848  16.511 &lt; 0.0000000000000002 ***
as.factor(hour)12  0.2001697  0.0079651  25.131 &lt; 0.0000000000000002 ***
as.factor(hour)13  0.1834693  0.0079446  23.094 &lt; 0.0000000000000002 ***
as.factor(hour)14  0.1894740  0.0079350  23.878 &lt; 0.0000000000000002 ***
as.factor(hour)15  0.2256510  0.0079437  28.406 &lt; 0.0000000000000002 ***
as.factor(hour)16  0.2748485  0.0079597  34.530 &lt; 0.0000000000000002 ***
as.factor(hour)17  0.3568287  0.0079903  44.658 &lt; 0.0000000000000002 ***
as.factor(hour)18  0.1712821  0.0079927  21.430 &lt; 0.0000000000000002 ***
as.factor(hour)19  0.0884182  0.0079724  11.091 &lt; 0.0000000000000002 ***
as.factor(hour)20  0.0183403  0.0079699   2.301              0.02138 *  
as.factor(hour)21  0.0144891  0.0079401   1.825              0.06803 .  
as.factor(hour)22  0.0252975  0.0079210   3.194              0.00140 ** 
as.factor(hour)23  0.0216694  0.0079105   2.739              0.00616 ** 
dotw_simple2       0.0204023  0.0042393   4.813      0.0000014898921 ***
dotw_simple3       0.0109642  0.0043909   2.497              0.01252 *  
dotw_simple4      -0.0017846  0.0042478  -0.420              0.67440    
dotw_simple5       0.0119251  0.0042419   2.811              0.00494 ** 
dotw_simple6      -0.0718362  0.0042473 -16.914 &lt; 0.0000000000000002 ***
dotw_simple7      -0.0412702  0.0042671  -9.672 &lt; 0.0000000000000002 ***
Temperature        0.0036650  0.0001409  26.019 &lt; 0.0000000000000002 ***
Precipitation     -0.6138873  0.0537180 -11.428 &lt; 0.0000000000000002 ***
lag1Hour           0.2278355  0.0016252 140.191 &lt; 0.0000000000000002 ***
lag3Hours          0.0968586  0.0015982  60.606 &lt; 0.0000000000000002 ***
lag1day            0.2413146  0.0016078 150.093 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6793 on 354109 degrees of freedom
Multiple R-squared:  0.2327,    Adjusted R-squared:  0.2326 
F-statistic:  3159 on 34 and 354109 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><strong>Question:</strong> Did adding lags improve R²? Why or why not?</p>
</section>
<section id="model-3-add-demographics-1" class="level4">
<h4 class="anchored" data-anchor-id="model-3-add-demographics-1">Model 3: Add Demographics</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>model3_q1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q1</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary too long with all station dummies, just show key metrics</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 3 R-squared:"</span>, <span class="fu">summary</span>(model3_q1)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 3 R-squared: 0.2371779 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 3 Adj R-squared:"</span>, <span class="fu">summary</span>(model3_q1)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 3 Adj R-squared: 0.2370982 </code></pre>
</div>
</div>
</section>
<section id="model-4-add-station-fixed-effects-1" class="level4">
<h4 class="anchored" data-anchor-id="model-4-add-station-fixed-effects-1">Model 4: Add Station Fixed Effects</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model4_q1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q1</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary too long with all station dummies, just show key metrics</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 4 R-squared:"</span>, <span class="fu">summary</span>(model4_q1)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 4 R-squared: 0.2647377 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 4 Adj R-squared:"</span>, <span class="fu">summary</span>(model4_q1)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 4 Adj R-squared: 0.2641746 </code></pre>
</div>
</div>
<p><strong>What do station fixed effects capture?</strong> Baseline differences in demand across stations (some are just busier than others!).</p>
</section>
<section id="model-5-add-rush-hour-interaction-1" class="level4">
<h4 class="anchored" data-anchor-id="model-5-add-rush-hour-interaction-1">Model 5: Add Rush Hour Interaction</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>model5_q1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span> rush_hour <span class="sc">+</span> <span class="fu">as.factor</span>(month) <span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    rush_hour <span class="sc">*</span> weekend,  <span class="co"># Rush hour effects different on weekends</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q1</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 5 R-squared:"</span>, <span class="fu">summary</span>(model5_q1)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 5 R-squared: 0.2694846 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 5 Adj R-squared:"</span>, <span class="fu">summary</span>(model5_q1)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 5 Adj R-squared: 0.268919 </code></pre>
</div>
</div>
</section>
<section id="model-performance-summary-training-set-1" class="level4">
<h4 class="anchored" data-anchor-id="model-performance-summary-training-set-1">Model performance summary (training set)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>model_rsq_q1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">paste0</span>(<span class="st">"Model "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"Time + Weather"</span>, <span class="st">"+ Temporal Lags"</span>, <span class="st">"+ Demographics"</span>, </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"+ Station Fixed Effects"</span>, <span class="st">"+ Rush Hour Interaction"</span>),</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model1_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model2_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model3_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model4_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model5_q1)<span class="sc">$</span>r.squared</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(model_rsq_q1,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"2025 Q1 Model Performance"</span>,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Description"</span>, <span class="st">"R²"</span>),</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>2025 Q1 Model Performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R²</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1</td>
<td style="text-align: left;">Time + Weather</td>
<td style="text-align: right;">0.080</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 2</td>
<td style="text-align: left;">+ Temporal Lags</td>
<td style="text-align: right;">0.233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 3</td>
<td style="text-align: left;">+ Demographics</td>
<td style="text-align: right;">0.237</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 4</td>
<td style="text-align: left;">+ Station Fixed Effects</td>
<td style="text-align: right;">0.265</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 5</td>
<td style="text-align: left;">+ Rush Hour Interaction</td>
<td style="text-align: right;">0.269</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="model-evaluation-summary-test-set-1" class="level4">
<h4 class="anchored" data-anchor-id="model-evaluation-summary-test-set-1">Model Evaluation Summary (test set)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day of week factor with treatment (dummy) coding</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>test_q1 <span class="ot">&lt;-</span> test_q1 <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrasts to treatment coding (dummy variables)</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(test_q1<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>test_q1 <span class="ot">&lt;-</span> test_q1 <span class="sc">%&gt;%</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred1 =</span> <span class="fu">predict</span>(model1_q1, <span class="at">newdata =</span> test_q1),</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred2 =</span> <span class="fu">predict</span>(model2_q1, <span class="at">newdata =</span> test_q1),</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred3 =</span> <span class="fu">predict</span>(model3_q1, <span class="at">newdata =</span> test_q1),</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred4 =</span> <span class="fu">predict</span>(model4_q1, <span class="at">newdata =</span> test_q1),</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred5 =</span> <span class="fu">predict</span>(model5_q1, <span class="at">newdata =</span> test_q1)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MAE for each model</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>mae_results_q1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">paste0</span>(<span class="st">"Model "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"Time + Weather"</span>, <span class="st">"+ Temporal Lags"</span>, <span class="st">"+ Demographics"</span>, </span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"+ Station Fixed Effects"</span>, <span class="st">"+ Rush Hour Interaction"</span>),</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE_q1 =</span> <span class="fu">c</span>(</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred1), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred5), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mae_results_q1, </span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"2025 Q1 Model Evaluation"</span>,</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Description"</span>, <span class="st">"MAE"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>2025 Q1 Model Evaluation</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1</td>
<td style="text-align: left;">Time + Weather</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 2</td>
<td style="text-align: left;">+ Temporal Lags</td>
<td style="text-align: right;">0.54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 3</td>
<td style="text-align: left;">+ Demographics</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 4</td>
<td style="text-align: left;">+ Station Fixed Effects</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 5</td>
<td style="text-align: left;">+ Rush Hour Interaction</td>
<td style="text-align: right;">0.53</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="model-performance-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-comparison">9.3 Model Performance Comparison</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>r2_q3_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model1_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model2_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model3_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model4_q3)<span class="sc">$</span>r.squared,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model5_q3)<span class="sc">$</span>r.squared</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>mae_q3_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred1), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred5), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>r2_q1_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model1_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model2_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model3_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model4_q1)<span class="sc">$</span>r.squared,</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model5_q1)<span class="sc">$</span>r.squared</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>mae_q1_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred1), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(test_q1<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q1<span class="sc">$</span>pred5), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>comparison_matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"1. Time + Weather"</span>, <span class="st">"2. + Temporal Lags"</span>, <span class="st">"3. + Demographics"</span>, <span class="st">"4. + Station FE"</span>, <span class="st">"5. + Rush Hour"</span>),</span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_Q3_2024 =</span> r2_q3_vec,</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_Q1_2025 =</span> r2_q1_vec,</span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE_Q3_2024 =</span> mae_q3_vec,</span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE_Q1_2025 =</span> mae_q1_vec</span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(comparison_matrix, </span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Performance Comparison: Summer (Q3 2024) vs Winter (Q1 2025)"</span>,</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Model Description"</span>, <span class="st">"Q3 (Summer)"</span>, <span class="st">"Q1 (Winter)"</span>, <span class="st">"Q3 (Summer)"</span>, <span class="st">"Q1 (Winter)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"R-Squared (Training Fit)"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"MAE (Testing Error)"</span> <span class="ot">=</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>), <span class="at">full_width =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">4</span>, <span class="at">bold =</span> T, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">background =</span> <span class="st">"#e6f3ff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Model Performance Comparison: Summer (Q3 2024) vs Winter (Q1 2025)</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
R-Squared (Training Fit)
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
MAE (Testing Error)
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Q3 (Summer)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Q1 (Winter)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Q3 (Summer)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Q1 (Winter)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1. Time + Weather</td>
<td style="text-align: right;">0.112</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: right;">0.830</td>
<td style="text-align: right;">0.625</td>
</tr>
<tr class="even">
<td style="text-align: left;">2. + Temporal Lags</td>
<td style="text-align: right;">0.308</td>
<td style="text-align: right;">0.233</td>
<td style="text-align: right;">0.714</td>
<td style="text-align: right;">0.535</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3. + Demographics</td>
<td style="text-align: right;">0.314</td>
<td style="text-align: right;">0.237</td>
<td style="text-align: right;">0.717</td>
<td style="text-align: right;">0.533</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important; background-color: rgba(230, 243, 255, 255) !important;">4. + Station FE</td>
<td style="text-align: right; font-weight: bold; color: black !important; background-color: rgba(230, 243, 255, 255) !important;">0.343</td>
<td style="text-align: right; font-weight: bold; color: black !important; background-color: rgba(230, 243, 255, 255) !important;">0.265</td>
<td style="text-align: right; font-weight: bold; color: black !important; background-color: rgba(230, 243, 255, 255) !important;">0.713</td>
<td style="text-align: right; font-weight: bold; color: black !important; background-color: rgba(230, 243, 255, 255) !important;">0.527</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5. + Rush Hour</td>
<td style="text-align: right;">0.348</td>
<td style="text-align: right;">0.269</td>
<td style="text-align: right;">0.714</td>
<td style="text-align: right;">0.530</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mae_results_q3, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Model, <span class="sc">-</span>MAE_q3), <span class="at">y =</span> MAE_q3)) <span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#3182bd"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(MAE_q3, <span class="dv">4</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Model Performance Comparison"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Lower MAE = Better Predictions"</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Model"</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Absolute Error (trips)"</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  plotTheme <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/compare_models-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>MAE Value Comparison</p>
<p>The Winter model achieved a lower Mean Absolute Error compared to the Summer model, but this numerical superiority is largely an artifact of significantly lower ridership volumes rather than better predictive ability. Since winter data is heavily “zero-inflated”—meaning many station-hours have zero trips—the absolute errors are naturally smaller, whereas the high-volume, dynamic nature of summer ridership creates larger numerical fluctuations that result in higher absolute error values despite the summer model actually explaining more of the variance (R2&nbsp;of 0.343 vs.&nbsp;0.265).</p></li>
<li><p>Temporal Patterns Difference</p>
<p>Temporal patterns differ markedly between the seasons, with Summer displaying a more robust and predictable structure driven by a consistent blend of commuting and leisure activity, which allowed the model to explain 34.3% of the variance. Conversely, Winter patterns are more stochastic and difficult to model (lower&nbsp;R2&nbsp;of 26.5%), likely because cold-weather riding is strictly utilitarian and highly sensitive to immediate, random weather events rather than the reliable behavioral routines seen in warmer months.</p></li>
<li><p>The most important features</p>
<p>In the Summer quarter,&nbsp;<strong>Temporal Lags</strong>&nbsp;were unequivocally the most important feature, as their addition caused the model’s&nbsp;R2&nbsp;to surge from a baseline of 0.112 to 0.308, proving that recent demand history is the single strongest predictor of near-future activity. While demographic variables added negligible value,&nbsp;<strong>Station Fixed Effects</strong>&nbsp;served as the second most critical component, raising the&nbsp;R2&nbsp;to 0.343 by successfully capturing the intrinsic, static popularity differences between high-traffic hubs and quiet residential stations.&nbsp;</p></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="part-2-error-analysis" class="level1">
<h1>PART 2: Error Analysis</h1>
<section id="spatial-error-patterns" class="level2">
<h2 class="anchored" data-anchor-id="spatial-error-patterns">1. Spatial Error Patterns</h2>
<p>Are prediction errors clustered in certain parts of Philadelphia?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate station errors</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>station_errors <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pred4)) <span class="sc">%&gt;%</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_station, start_lat, start_lon) <span class="sc">%&gt;%</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(Trip_Count <span class="sc">-</span> pred4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_demand =</span> <span class="fu">mean</span>(Trip_Count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_lat), <span class="sc">!</span><span class="fu">is.na</span>(start_lon))</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Map 1: Prediction Errors</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> philly_census, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> station_errors,</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> start_lon, <span class="at">y =</span> start_lat, <span class="at">color =</span> MAE),</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"MAE</span><span class="sc">\n</span><span class="st">(trips)"</span>,</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>),  <span class="co"># Fewer, cleaner breaks</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.5"</span>, <span class="st">"1.0"</span>, <span class="st">"1.5"</span>)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Prediction Errors"</span>,</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Higher in Center City"</span>) <span class="sc">+</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>  mapTheme <span class="sc">+</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">barwidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">barheight =</span> <span class="dv">12</span>,</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.hjust =</span> <span class="fl">0.5</span></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Map 2: Average Demand</span></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> philly_census, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> station_errors,</span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> start_lon, <span class="at">y =</span> start_lat, <span class="at">color =</span> avg_demand),</span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.7</span></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(</span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"viridis"</span>,</span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Avg</span><span class="sc">\n</span><span class="st">Demand"</span>,</span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">2.5</span>),  <span class="co"># Clear breaks</span></span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.5"</span>, <span class="st">"1.0"</span>, <span class="st">"1.5"</span>, <span class="st">"2.0"</span>, <span class="st">"2.5"</span>)</span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Demand"</span>,</span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Trips per station-hour"</span>) <span class="sc">+</span></span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a>  mapTheme <span class="sc">+</span></span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">barwidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">barheight =</span> <span class="dv">12</span>,</span>
<span id="cb102-74"><a href="#cb102-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb102-75"><a href="#cb102-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">title.hjust =</span> <span class="fl">0.5</span></span>
<span id="cb102-76"><a href="#cb102-76" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb102-77"><a href="#cb102-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb102-80"><a href="#cb102-80" aria-hidden="true" tabindex="-1"></a>  p1, p2,</span>
<span id="cb102-81"><a href="#cb102-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb102-82"><a href="#cb102-82" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/spatial_errors-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Question:</strong> Do you see spatial clustering of errors? What neighborhoods have high errors?</p>
</section>
<section id="temporal-error-patterns" class="level2">
<h2 class="anchored" data-anchor-id="temporal-error-patterns">2. Temporal Error Patterns</h2>
<p>When are we most wrong?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> Trip_Count <span class="sc">-</span> pred4,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">abs_error =</span> <span class="fu">abs</span>(error),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_of_day =</span> <span class="fu">case_when</span>(</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      hour <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Overnight"</span>,</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>      hour <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> hour <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"AM Rush"</span>,</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>      hour <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> hour <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">"Mid-Day"</span>,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>      hour <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"PM Rush"</span>,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>      hour <span class="sc">&gt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Evening"</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot by time and day type</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_q3, <span class="fu">aes</span>(<span class="at">x =</span> Trip_Count, <span class="at">y =</span> pred4)) <span class="sc">+</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"#3182bd"</span>) <span class="sc">+</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(weekend <span class="sc">~</span> time_of_day) <span class="sc">+</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Observed vs. Predicted Bike Trips"</span>,</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Model 4 performance by time period"</span>,</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Observed Trips"</span>,</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Trips"</span>,</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red line = perfect predictions; Green line = actual model fit"</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>  plotTheme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/obs_vs_pred-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAE by time of day and day type</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>temporal_errors <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_of_day, weekend) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">mean</span>(abs_error, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_type =</span> <span class="fu">ifelse</span>(weekend <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>))</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temporal_errors, <span class="fu">aes</span>(<span class="at">x =</span> time_of_day, <span class="at">y =</span> MAE, <span class="at">fill =</span> day_type)) <span class="sc">+</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Weekday"</span> <span class="ot">=</span> <span class="st">"#08519c"</span>, <span class="st">"Weekend"</span> <span class="ot">=</span> <span class="st">"#6baed6"</span>)) <span class="sc">+</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prediction Errors by Time Period"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"2024 Q3"</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Absolute Error (trips)"</span>,</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Day Type"</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  plotTheme <span class="sc">+</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/temporal_errors-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="demographics-error-patterns" class="level2">
<h2 class="anchored" data-anchor-id="demographics-error-patterns">3. Demographics Error Patterns</h2>
<p>Are prediction errors related to neighborhood characteristics?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join demographic data to station errors</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>station_errors_demo <span class="ot">&lt;-</span> station_errors <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  stations_census_q3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_station, Med_Inc, Percent_Taking_Transit, Percent_White),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"start_station"</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Med_Inc))</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(station_errors_demo, <span class="fu">aes</span>(<span class="at">x =</span> Med_Inc, <span class="at">y =</span> MAE)) <span class="sc">+</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#3182bd"</span>) <span class="sc">+</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Errors vs. Median Income"</span>, <span class="at">x =</span> <span class="st">"Median Income"</span>, <span class="at">y =</span> <span class="st">"MAE"</span>) <span class="sc">+</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(station_errors_demo, <span class="fu">aes</span>(<span class="at">x =</span> Percent_Taking_Transit, <span class="at">y =</span> MAE)) <span class="sc">+</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#3182bd"</span>) <span class="sc">+</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Errors vs. Transit Usage"</span>, <span class="at">x =</span> <span class="st">"% Taking Transit"</span>, <span class="at">y =</span> <span class="st">"MAE"</span>) <span class="sc">+</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(station_errors_demo, <span class="fu">aes</span>(<span class="at">x =</span> Percent_White, <span class="at">y =</span> MAE)) <span class="sc">+</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#3182bd"</span>) <span class="sc">+</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Errors vs. Race"</span>, <span class="at">x =</span> <span class="st">"% White"</span>, <span class="at">y =</span> <span class="st">"MAE"</span>) <span class="sc">+</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  plotTheme</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Indego_SpaceTime_Prediction_files/figure-html/errors_demographics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Critical Question:</strong> Are prediction errors systematically higher in certain demographic groups? What are the equity implications?</p>
<hr>
</section>
</section>
<section id="part-3-feature-engineering-model-improvement" class="level1">
<h1>PART 3: Feature Engineering &amp; model improvement</h1>
<p>Based on your error analysis, add 2-3 NEW features to improve the model:</p>
<section id="temporal-features-school-calendar" class="level2">
<h2 class="anchored" data-anchor-id="temporal-features-school-calendar">3.1 Temporal features: School calendar</h2>
<section id="add-school-feature" class="level3">
<h3 class="anchored" data-anchor-id="add-school-feature">3.1.1 Add School Feature</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Penn Session Logic</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_penn_session =</span> <span class="fu">case_when</span>(</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-07-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-07-03"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-07-05"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-08-09"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-08-21"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-09-03"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-09-05"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-09-30"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># All other dates (holidays/breaks) are 0</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drexel Session Logic</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_drexel_session =</span> <span class="fu">case_when</span>(</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-07-01"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-07-03"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-07-06"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-07-27"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-07-29"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-08-31"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&gt;=</span> <span class="st">"2024-09-03"</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="st">"2024-09-20"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># All other dates (holidays/breaks) are 0</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="refresh-the-split" class="level3">
<h3 class="anchored" data-anchor-id="refresh-the-split">3.1.2 Refresh the Split</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-apply the split using the same week logic as Part 8.1</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">36</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">36</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="build-model-6-school-features" class="level3">
<h3 class="anchored" data-anchor-id="build-model-6-school-features">3.1.3 Build Model 6 (+School features)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> train_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>))) </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(train_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>model6_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>( Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Temperature <span class="sc">+</span> Precipitation <span class="sc">+</span> lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span> Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span> <span class="fu">as.factor</span>(start_station) <span class="sc">+</span> is_penn_session <span class="sc">+</span>  is_drexel_session,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_q3 )</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 6 R-squared:"</span>, <span class="fu">summary</span>(model6_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 6 R-squared: 0.3434728 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 6 Adj R-squared:"</span>, <span class="fu">summary</span>(model6_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 6 Adj R-squared: 0.3429655 </code></pre>
</div>
</div>
</section>
<section id="evaluate-model-6-school-features" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-model-6-school-features">3.1.4 Evaluate Model 6 (+School features)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Test Set Factors</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(test_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>test_q3<span class="sc">$</span>pred_school <span class="ot">&lt;-</span> <span class="fu">predict</span>(model6_q3, <span class="at">newdata =</span> test_q3)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MAE</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>mae_school <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred_school), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"New Feature MAE:"</span>, <span class="fu">round</span>(mae_school, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>New Feature MAE: 0.711 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Did the school calendar improve the model?"</span>, <span class="fu">ifelse</span>(mae_school <span class="sc">&lt;</span> <span class="fl">0.713</span>, <span class="st">"YES"</span>, <span class="st">"NO"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Did the school calendar improve the model? YES </code></pre>
</div>
</div>
</section>
</section>
<section id="weather-features-weekend-nice-weather-interaction" class="level2">
<h2 class="anchored" data-anchor-id="weather-features-weekend-nice-weather-interaction">3.2 Weather features: Weekend + nice weather interaction</h2>
<section id="add-weather-interaction" class="level3">
<h3 class="anchored" data-anchor-id="add-weather-interaction">3.2.1 Add Weather Interaction</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define "Nice Weather"</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Criteria: Temperature between 60°F and 75°F, and NO rain (Precipitation == 0)</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a binary flag for this.</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>study_panel_complete_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nice_weather =</span> <span class="fu">ifelse</span>(Temperature <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> Temperature <span class="sc">&lt;=</span> <span class="dv">75</span> <span class="sc">&amp;</span> Precipitation <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the Interaction Term</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This specifically targets "Nice Weekends" (Weekend == 1 AND Nice Weather == 1)</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekend_nice =</span> weekend <span class="sc">*</span> nice_weather</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="refresh-the-split-1" class="level3">
<h3 class="anchored" data-anchor-id="refresh-the-split-1">3.2.2 Refresh the Split</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train on weeks &lt; 36, Test on weeks &gt;= 36</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">36</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">36</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="build-model-7-weather-interaction" class="level3">
<h3 class="anchored" data-anchor-id="build-model-7-weather-interaction">3.2.3 Build Model 7(+ Weather Interaction)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure factors are set up (standard prep)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>train_q3 <span class="ot">&lt;-</span> train_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(train_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 7: Model 4 + Schools + Weather Interaction</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>model7_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station) <span class="sc">+</span> </span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>    is_penn_session <span class="sc">+</span>    <span class="co"># Keep School Feature</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>    is_drexel_session <span class="sc">+</span>  <span class="co"># Keep School Feature</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>    weekend_nice,        <span class="co"># &lt;--- NEW INTERACTION FEATURE</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Output Model Summary</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 7 Adj R-squared:"</span>, <span class="fu">summary</span>(model7_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 7 Adj R-squared: 0.3434627 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 7 Adj R-squared:"</span>, <span class="fu">summary</span>(model7_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 7 Adj R-squared: 0.3429554 </code></pre>
</div>
</div>
</section>
<section id="evaluate-model-7" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-model-7">3.2.4 Evaluate Model 7</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Test Set</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(test_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>test_q3<span class="sc">$</span>pred_weather <span class="ot">&lt;-</span> <span class="fu">predict</span>(model7_q3, <span class="at">newdata =</span> test_q3)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MAE</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>mae_weather <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred_weather), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE (Schools + Weather):"</span>, <span class="fu">round</span>(mae_weather, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAE (Schools + Weather): 0.71 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Did the Weekend + nice weather interaction improve the model?"</span>, <span class="fu">ifelse</span>(mae_weather <span class="sc">&lt;</span> <span class="fl">0.711</span>, <span class="st">"YES"</span>, <span class="st">"NO"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Did the Weekend + nice weather interaction improve the model? YES </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="删掉了温度" class="level1">
<h1>删掉了温度</h1>
<section id="attempt-for-poisson-model" class="level2">
<h2 class="anchored" data-anchor-id="attempt-for-poisson-model">3.3 Attempt for Poisson Model</h2>
<section id="build-model-8-poisson" class="level3">
<h3 class="anchored" data-anchor-id="build-model-8-poisson">3.3.1 Build Model 8 (Poisson)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Poisson Model using the best features from Model 7</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: family = "poisson" is the key change here</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>model8_q3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  Trip_Count <span class="sc">~</span> <span class="fu">as.factor</span>(hour) <span class="sc">+</span> dotw_simple <span class="sc">+</span> Precipitation <span class="sc">+</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    lag1Hour <span class="sc">+</span> lag3Hours <span class="sc">+</span> lag1day <span class="sc">+</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    Med_Inc <span class="sc">+</span> Percent_Taking_Transit <span class="sc">+</span> Percent_White <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.factor</span>(start_station) <span class="sc">+</span> </span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    is_penn_session <span class="sc">+</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>    is_drexel_session <span class="sc">+</span>  </span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>    weekend_nice,        </span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_q3</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Output Model Summary</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 8 Adj R-squared:"</span>, <span class="fu">summary</span>(model8_q3)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 8 Adj R-squared: </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 8 Adj R-squared:"</span>, <span class="fu">summary</span>(model8_q3)<span class="sc">$</span>adj.r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 8 Adj R-squared: </code></pre>
</div>
</div>
</section>
<section id="evaluate-model-8" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-model-8">3.3.2 Evaluate Model 8</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Predict on Test Data</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># type = "response" is crucial for GLM to get the actual count (not log-count)</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>test_q3<span class="sc">$</span>pred_poisson <span class="ot">&lt;-</span> <span class="fu">predict</span>(model8_q3, <span class="at">newdata =</span> test_q3, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate MAE for Poisson</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>mae_m8 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> test_q3<span class="sc">$</span>pred_poisson), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Compare with Best OLS Model (Model 7)</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model 7 (OLS) MAE:"</span>, <span class="fu">round</span>(mae_weather, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model 7 (OLS) MAE: 0.71 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Poisson Model MAE:"</span>, <span class="fu">round</span>(mae_m8, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Poisson Model MAE: 0.666 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Did Poisson improve performance?"</span>, <span class="fu">ifelse</span>(mae_m8 <span class="sc">&lt;</span> mae_weather, <span class="st">"YES"</span>, <span class="st">"NO"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Did Poisson improve performance? YES </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> study_panel_complete_q3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(week <span class="sc">&gt;=</span> <span class="dv">36</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>test_q3 <span class="ot">&lt;-</span> test_q3 <span class="sc">%&gt;%</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dotw_simple =</span> <span class="fu">factor</span>(dotw, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>)))</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(test_q3<span class="sc">$</span>dotw_simple) <span class="ot">&lt;-</span> <span class="fu">contr.treatment</span>(<span class="dv">7</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recalculate the predicted values of all models</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="at">m1 =</span> <span class="fu">predict</span>(model1_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">m2 =</span> <span class="fu">predict</span>(model2_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">m3 =</span> <span class="fu">predict</span>(model3_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">m4 =</span> <span class="fu">predict</span>(model4_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">m5 =</span> <span class="fu">predict</span>(model5_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">m6 =</span> <span class="fu">predict</span>(model6_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">m7 =</span> <span class="fu">predict</span>(model7_q3, <span class="at">newdata =</span> test_q3),</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pois =</span> <span class="fu">predict</span>(model8_q3, <span class="at">newdata =</span> test_q3, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>mae_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(preds, <span class="cf">function</span>(p) <span class="fu">mean</span>(<span class="fu">abs</span>(test_q3<span class="sc">$</span>Trip_Count <span class="sc">-</span> p), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>all_models_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Model 1"</span>, <span class="st">"Model 2"</span>, <span class="st">"Model 3"</span>, <span class="st">"Model 4"</span>, <span class="st">"Model 5"</span>, <span class="st">"Model 6"</span>, <span class="st">"Model 7"</span>, <span class="st">"Model 8"</span>),</span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(</span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time + Weather (Baseline)"</span>,</span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ Temporal Lags"</span>,</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ Demographics"</span>,</span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ Station Fixed Effects"</span>,</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ Rush Hour Interaction"</span>,</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ School Calendars"</span>,</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ Weather Interaction"</span>,</span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Poisson Regression (Full)"</span></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE =</span> mae_values</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup baseline(Model 1)</span></span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>baseline_mae <span class="ot">&lt;-</span> all_models_df<span class="sc">$</span>MAE[<span class="dv">1</span>]</span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>all_models_df<span class="sc">$</span>Improvement_vs_M1 <span class="ot">&lt;-</span> (baseline_mae <span class="sc">-</span> all_models_df<span class="sc">$</span>MAE) <span class="sc">/</span> baseline_mae</span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup baseline2(Model2)</span></span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a>lag_mae <span class="ot">&lt;-</span> all_models_df<span class="sc">$</span>MAE[<span class="dv">2</span>]</span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a>all_models_df<span class="sc">$</span>Improvement_vs_M2 <span class="ot">&lt;-</span> (lag_mae <span class="sc">-</span> all_models_df<span class="sc">$</span>MAE) <span class="sc">/</span> lag_mae</span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a>all_models_df <span class="sc">%&gt;%</span></span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">round</span>(MAE, <span class="dv">3</span>),</span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">% Better than M1</span><span class="st">`</span> <span class="ot">=</span> scales<span class="sc">::</span><span class="fu">percent</span>(Improvement_vs_M1, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">% Better than M2</span><span class="st">`</span> <span class="ot">=</span> scales<span class="sc">::</span><span class="fu">percent</span>(Improvement_vs_M2, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, Description, MAE, <span class="st">`</span><span class="at">% Better than M1</span><span class="st">`</span>, <span class="st">`</span><span class="at">% Better than M2</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Part 3: All Models Performance Summary - Q3 2024"</span>,</span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>)</span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">which.min</span>(all_models_df<span class="sc">$</span>MAE), <span class="at">bold =</span> T, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#3182bd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Part 3: All Models Performance Summary - Q3 2024</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">MAE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">% Better than M1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">% Better than M2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m1</td>
<td style="text-align: left;">Model 1</td>
<td style="text-align: left;">Time + Weather (Baseline)</td>
<td style="text-align: center;">0.830</td>
<td style="text-align: center;">0.0%</td>
<td style="text-align: center;">-16.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">m2</td>
<td style="text-align: left;">Model 2</td>
<td style="text-align: left;">+ Temporal Lags</td>
<td style="text-align: center;">0.714</td>
<td style="text-align: center;">14.0%</td>
<td style="text-align: center;">0.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m3</td>
<td style="text-align: left;">Model 3</td>
<td style="text-align: left;">+ Demographics</td>
<td style="text-align: center;">0.717</td>
<td style="text-align: center;">13.7%</td>
<td style="text-align: center;">-0.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">m4</td>
<td style="text-align: left;">Model 4</td>
<td style="text-align: left;">+ Station Fixed Effects</td>
<td style="text-align: center;">0.713</td>
<td style="text-align: center;">14.1%</td>
<td style="text-align: center;">0.1%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m5</td>
<td style="text-align: left;">Model 5</td>
<td style="text-align: left;">+ Rush Hour Interaction</td>
<td style="text-align: center;">0.714</td>
<td style="text-align: center;">14.0%</td>
<td style="text-align: center;">0.0%</td>
</tr>
<tr class="even">
<td style="text-align: left;">m6</td>
<td style="text-align: left;">Model 6</td>
<td style="text-align: left;">+ School Calendars</td>
<td style="text-align: center;">0.711</td>
<td style="text-align: center;">14.3%</td>
<td style="text-align: center;">0.4%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m7</td>
<td style="text-align: left;">Model 7</td>
<td style="text-align: left;">+ Weather Interaction</td>
<td style="text-align: center;">0.710</td>
<td style="text-align: center;">14.5%</td>
<td style="text-align: center;">0.6%</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">pois</td>
<td style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">Model 8</td>
<td style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">Poisson Regression (Full)</td>
<td style="text-align: center; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">0.666</td>
<td style="text-align: center; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">19.9%</td>
<td style="text-align: center; font-weight: bold; color: white !important; background-color: rgba(49, 130, 189, 255) !important;">6.8%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Implementation:</strong></p>
<ul>
<li>Add your features to the best model</li>
<li>Compare MAE before and after</li>
<li>Explain <em>why</em> you chose these features</li>
<li>Did they improve predictions? Where?</li>
</ul>
<p><strong>Try a poisson model for count data</strong></p>
<ul>
<li>Does this improve model fit?</li>
</ul>
</section>
</section>
</section>
<section id="part-4-critical-reflection" class="level1">
<h1>PART 4: Critical Reflection</h1>
<section id="operational-implications" class="level2">
<h2 class="anchored" data-anchor-id="operational-implications"><strong>1. Operational implications:</strong></h2>
<ul>
<li>Is your final MAE “good enough” for Indego to use?</li>
<li>When do prediction errors cause problems for rebalancing?</li>
<li>Would you recommend deploying this system? Under what conditions?</li>
</ul>
</section>
<section id="equity-considerations" class="level2">
<h2 class="anchored" data-anchor-id="equity-considerations"><strong>2. Equity considerations:</strong></h2>
<ul>
<li>Do prediction errors disproportionately affect certain neighborhoods?</li>
<li>Could this system worsen existing disparities in bike access?</li>
<li>What safeguards would you recommend?</li>
</ul>
</section>
<section id="model-limitations" class="level2">
<h2 class="anchored" data-anchor-id="model-limitations"><strong>3. Model limitations:</strong></h2>
<ul>
<li>What patterns is your model missing?</li>
<li>What assumptions might not hold in real deployment?</li>
<li>How would you improve this with more time/data?</li>
</ul>
<hr>
<ol type="1">
<li><p><strong>Brief report</strong> summarizing (with supporting data &amp; visualization):</p>
<ul>
<li>Your quarter and why you chose it</li>
<li>Model comparison results</li>
<li>Error analysis insights</li>
<li>New features you added and why</li>
<li>Critical reflection on deployment</li>
</ul></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>